{"pageContext":{"group":[{"node":{"fields":{"slug":"/2017-05-28-kotlin-aws-lambda-serverless-framework/"},"html":"<p>Some time ago I came across the following tweet.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/tweet_aws_kotlin-e087ba82deeb3973414aa247f4b459e6-7da6e.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 581px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.16006884681583%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHZdqESD//EABYQAAMAAAAAAAAAAAAAAAAAABESIP/aAAgBAQABBQILX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAABIDFB/9oACAEBAAY/AtKcf//EABwQAQACAQUAAAAAAAAAAAAAAAEAEEERITFh0f/aAAgBAQABPyHTsB55gp7Qems1/9oADAMBAAIAAwAAABDDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQABAwUAAAAAAAAAAAAAAAEAETFxEEFhgbH/2gAIAQEAAT8QrqOVqEgvKzdjMMlvMb9w8Gn/2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"tweet_aws_kotlin\"\n        title=\"\"\n        src=\"/static/tweet_aws_kotlin-e087ba82deeb3973414aa247f4b459e6-7da6e.jpg\"\n        srcset=\"/static/tweet_aws_kotlin-e087ba82deeb3973414aa247f4b459e6-c0cf3.jpg 270w,\n/static/tweet_aws_kotlin-e087ba82deeb3973414aa247f4b459e6-277b5.jpg 540w,\n/static/tweet_aws_kotlin-e087ba82deeb3973414aa247f4b459e6-7da6e.jpg 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>There were two things that took my attention - kotlin and Rekognition.</p>\n<!-- end -->\n<p>First one is a “new” (it’s relly developed by over 6 years now) JVM language created by JetBrains, company that stands behind great tooling for developers of different professions. The second is an AWS service, this is how it is described on their page</p>\n<blockquote>\n<p>Amazon Rekognition is a service that makes it easy to add image analysis to your applications. With Rekognition, you can detect objects, scenes faces; search and compare faces, and identify inappropriate content in images. Rekognition’s API enables you to quickly add sophisticated deep learning-based visual search and image classification to your applications.</p>\n</blockquote>\n<p>as we will see soon this API is very easy to use.</p>\n<h2>Why</h2>\n<p>At this point for me, it was the first contact with pretty nice and interesting example of AWS Lambda usage created by <a href=\"https://twitter.com/VladimirBudilov\">Vladimir Budilov</a> (here is a  <a href=\"https://github.com/awslabs/serverless-photo-recognition\">github</a> repository). For these who are not familiar with AWS Lambda term -  it is a new category of cloud computing services called FaaS (function as a service). It stands next to IaaS (infrastructure as a service), PaaS (platform as a service) and SaaS (software as a service) it is also referred as Serverless architecture. In short, you focus only on your business logic and don’t care about provisioning and managing servers.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 801px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.06242197253433%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIDBP/aAAwDAQACEAMQAAAB7Lazqq65/8QAGRAAAwADAAAAAAAAAAAAAAAAAAECEBEh/9oACAEBAAEFAt2dHNN5/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/AQyf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQIDEP/aAAgBAgEBPwGVi5//xAAaEAACAgMAAAAAAAAAAAAAAAABMQACICEi/9oACAEBAAY/AmXD0XNWw//EABoQAQACAwEAAAAAAAAAAAAAAAEAEDFRcdH/2gAIAQEAAT8hHoQeqhqexw9r/9oADAMBAAIAAwAAABD43//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFh/9oACAEDAQE/EE0Jw//EABgRAAIDAAAAAAAAAAAAAAAAAAABEVFh/9oACAECAQE/EMMh2f/EABwQAAICAgMAAAAAAAAAAAAAAAABETEhQVFx8P/aAAgBAQABPxBe4x89EqpP0zEWOiOpVg0fH2Kj/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"faas_diagram\"\n        title=\"\"\n        src=\"/static/faas_diagram-75f2521335608d5d448030d8d8111009-44598.jpg\"\n        srcset=\"/static/faas_diagram-75f2521335608d5d448030d8d8111009-bd960.jpg 270w,\n/static/faas_diagram-75f2521335608d5d448030d8d8111009-adce9.jpg 540w,\n/static/faas_diagram-75f2521335608d5d448030d8d8111009-44598.jpg 801w\"\n        sizes=\"(max-width: 801px) 100vw, 801px\"\n      />\n    </span>\n  </span>\n  \n<sub>Source: Deploy microservice using Amazon Web Services S3, API Gateway, Lambda and Couchbase by Arun Gupta (<a href=\"https://www.youtube.com/watch?v=eT4EaU2mfL0\">https://www.youtube.com/watch?v=eT4EaU2mfL0</a>)</sub></p>\n<p>After analysing <a href=\"https://github.com/awslabs/serverless-photo-recognition\">serverless-photo-recognition</a> repository I felt urgent need to write something of my own. One thing that I considered not to be very concise was a setup step. The author created setup <a href=\"https://github.com/awslabs/serverless-photo-recognition/blob/master/setup/setupEnvironment.sh\">script</a> which is very verbose. So let’s start by making this process a lot more easier (to make and understand - for people not so familiar with AWS platform).</p>\n<h2>Serverless framework</h2>\n<p><a href=\"https://serverless.com/\">Serverless framework</a> is a cli tool that creates great abstraction over <a href=\"https://aws.amazon.com/cloudformation/\">AWS CloudFormation</a> and automates the whole process of setting up cloud infrastructure required by our functions. We start by installing <code class=\"language-text\">serverless framework</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g serverless</code></pre></div>\n<p>then a good idea is to create dedicated AWS user that will be used on behalf of <code class=\"language-text\">serverless framework</code>. Exact instruction of how to accomplish this can be found <a href=\"https://serverless.com/framework/docs/providers/aws/guide/credentials/\">here</a>. In my case, this user hides behind <code class=\"language-text\">sless</code> AWS cli profile name - <a href=\"https://github.com/ajurasz/ascii-less-gallery/blob/58ad818d1d0d7131b4cb5ad9e027cea815197656/serverless.yml#L6\">see here</a>. All configuration is placed in one file <code class=\"language-text\">serverless.yml</code>\nwhere we first define <code class=\"language-text\">provider</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws\n  <span class=\"token key atrule\">runtime</span><span class=\"token punctuation\">:</span> java8\n  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> sless\n  <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">DYNAMODB_USER_TABLE</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">:</span>service<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>opt<span class=\"token punctuation\">:</span>stage<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">:</span>provider.stage<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>user\n    <span class=\"token key atrule\">ES_DOMAIN_NAME</span><span class=\"token punctuation\">:</span> es<span class=\"token punctuation\">-</span>gallery\n    <span class=\"token key atrule\">REDIS_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>file(serverless<span class=\"token punctuation\">-</span>config.yml)<span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>opt<span class=\"token punctuation\">:</span>stage<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">:</span>provider.stage<span class=\"token punctuation\">}</span>.RedisUrl<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">REDIS_PORT</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>file(serverless<span class=\"token punctuation\">-</span>config.yml)<span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>opt<span class=\"token punctuation\">:</span>stage<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">:</span>provider.stage<span class=\"token punctuation\">}</span>.RedisPort<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ES_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>file(serverless<span class=\"token punctuation\">-</span>config.yml)<span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>opt<span class=\"token punctuation\">:</span>stage<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">:</span>provider.stage<span class=\"token punctuation\">}</span>.ElasticsearchUrl<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">iamRoleStatements</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Allow\"</span>\n      <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"lambda:InvokeFunction\"</span>\n      <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Allow\"</span>\n      <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"rekognition:DetectLabels\"</span>\n      <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Allow\"</span>\n      <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"es:ESHttpDelete\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"es:ESHttpGet\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"es:ESHttpPost\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"es:ESHttpPut\"</span>\n      <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"arn:aws:es:${opt:region, self:provider.region}:*:domain/${self:provider.environment.ES_DOMAIN_NAME}/*\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> Allow\n      <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"dynamodb:GetItem\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"dynamodb:PutItem\"</span>\n      <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_USER_TABLE}\"</span></code></pre></div>\n<p>this is a place where we can configure mentioned AWS cli profile, runtime environment, extend the limit of our functions execution time to 60 sec, define environment variables that will be accessible from within our functions and also we can define a security policy for a lambda role created automatically by <code class=\"language-text\">serverless</code>. From above snippet, we see that security statements were defined for lambda, elasticsearch, rekognition and dynamodb services, specifying what action we can execute on them.</p>\n<h2>Lambda in action</h2>\n<p>I wrote a simple CRD (no update) functions with custom authentication mechanism - probably using <a href=\"https://aws.amazon.com/cognito/\">AWS Cognito</a> would be a preferred way to go but I wanted to check how flexible are these lambda functions in terms of implementing own authentication. Application architecture is following</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-3ac81.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 1080px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.63636363636363%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACBUlEQVQ4y41Sy24TQRDcf+UvuCDxEAiRExLHXLhxRlzIiRwclhAngFkpmNixSRyMHezdmZ3ZeRU1Y29iohwyUql7e2qqH9tZCOEEQI+2oC1c8EXjHGELv461dxExthkP1/534n6GG8cTob+b0B4Sr/zXH0Y4OK1w2yHvZbZ2bNTyzvnGBy/nF76ajryhb4zxQghvrY25fDGc+sm8TD7f+bYGwvF7qxWMQTjTQPGq/rYD8fMzmsi2BoZxY22qolNMcDS4XHXDysN1+THBi2yj05TGEHJ4hHryAzalBRaiRtM0iXjY/43BxWL1yIf2WavxPAkqpX0ssvq1B6WXqM+OIWdnkKSq6RBq/BUNfbbP5wajaYn8ZNHOLbRdEs+ymHk2m3N+Fuf7r7BcnkN337LlfQgS9ekhdG8H0gFluUwFdY5n2N4d3yb49Krl1C7nrjkroRqIWkHQl3/GqEY98GdBSgnHmPceti6TvdHyk2xDPUWNdzEQfzkEKXpwAP3lHXScbVVSmGMYdmHeb5Hno9qm4KP/BQkuddo7x+yS1dTlX4j5BRMFVBQ0zkNdTiAH3cRpK1xrPGwFDeHS5jiXbFxKFb/7HWc/vXE6/nCfsqX79d659SJEMUs8yHCHY6zBHc/jKNil8h6R08+ZNq+1zpVpki+VygXh431AHnktd2XDx7CK04Z7/wDGsen+Gr0cggAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"architecture_aws_lambda\"\n        title=\"\"\n        src=\"/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-7381b.png\"\n        srcset=\"/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-d4801.png 270w,\n/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-15201.png 540w,\n/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-7381b.png 1080w,\n/static/architecture_aws_lambda-c345b9c56b520224ea049671d45bb9b6-3ac81.png 1210w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>I believe that above diagram is self-explanatory so let’s dive into one of the functions. <a href=\"https://github.com/ajurasz/ascii-less-gallery/blob/master/src/main/kotlin/ajurasz/lambda/gallery/CreateHandler.kt\">CreateHandler</a>, the entry point is <code class=\"language-text\">handleRequest</code> function triggered by AWS when an HTTP POST request reaches API Gateway at <code class=\"language-text\">/gallery</code> path.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n        LOG<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"input(\\n<span class=\"token interpolation variable\">$input</span>\\n)\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>base64Image <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>base64Image <span class=\"token keyword\">as</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isBlank</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Invalid identify request: no or empty 'base64Image' field supplied\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> imageInBytes <span class=\"token operator\">=</span> <span class=\"token function\">base64ToBytes</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>base64Image<span class=\"token operator\">!!</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> labels <span class=\"token operator\">=</span> rekognitionService<span class=\"token punctuation\">.</span><span class=\"token function\">imageLabels</span><span class=\"token punctuation\">(</span>imageInBytes<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> galleryItem <span class=\"token operator\">=</span> <span class=\"token function\">createGalleryItem</span><span class=\"token punctuation\">(</span>asciiService<span class=\"token punctuation\">,</span> imageInBytes<span class=\"token punctuation\">,</span> labels<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> result <span class=\"token operator\">=</span> esService<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>principalId<span class=\"token operator\">!!</span><span class=\"token punctuation\">,</span> galleryItem<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">when</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token boolean\">true</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">return</span> galleryItem<span class=\"token punctuation\">.</span>id\n            <span class=\"token keyword\">else</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">return</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to save image\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>In this function, we validate incoming request to check if base64 encoded image string exists and is not blank. Then encoded image is converted to <code class=\"language-text\">byte</code> array and passed to Rekognition service. This service is a wrapper around AWS Rekognition service to simplify interaction with it.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">    <span class=\"token keyword\">fun</span> <span class=\"token function\">imageLabels</span><span class=\"token punctuation\">(</span>image<span class=\"token operator\">:</span> ByteArray<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        LOG<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Recognize image labels\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> response <span class=\"token operator\">=</span> amazonRekognition<span class=\"token punctuation\">.</span><span class=\"token function\">detectLabels</span><span class=\"token punctuation\">(</span><span class=\"token function\">DetectLabelsRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withMaxLabels</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withMinConfidence</span><span class=\"token punctuation\">(</span><span class=\"token number\">60f</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withImage</span><span class=\"token punctuation\">(</span><span class=\"token function\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBytes</span><span class=\"token punctuation\">(</span>ByteBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> response<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>labels<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">orEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>As mentioned at the beginning, using AWS Rekognition service we were able to define a sophisticated deep learning-based operation of labelling objects present on a given image just in few lines of code.\nWhen using serverless framework we need to create a configuration for each function. Configuration for <code class=\"language-text\">CreateHandler</code> function is following</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">create</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> ajurasz.lambda.gallery.CreateHandler\n    <span class=\"token key atrule\">events</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> gallery\n          <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> post\n          <span class=\"token key atrule\">integration</span><span class=\"token punctuation\">:</span> lambda\n          <span class=\"token key atrule\">request</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">passThrough</span><span class=\"token punctuation\">:</span> WHEN_NO_TEMPLATES\n            <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">image/png</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'{ \"operation\" : \"create\", \"base64Image\" : \"$input.body\", \"principalId\" : \"$context.authorizer.principalId\" }'</span>\n          <span class=\"token key atrule\">authorizer</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> auth\n            <span class=\"token key atrule\">resultTtlInSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">identitySource</span><span class=\"token punctuation\">:</span> method.request.header.token</code></pre></div>\n<p>we see that this function is triggered by HTTP specific event - POST request to <code class=\"language-text\">/gallery</code> path. This configuration is little bit more complicated than for other functions and this is because we are not using default <code class=\"language-text\">lambda-proxy</code> integration (integration between API Gateway and Lambda) as we need to customize it to handle binary data. More information about handling binary data in AWS Lambda can be found <a href=\"https://aws.amazon.com/blogs/compute/binary-support-for-api-integrations-with-amazon-api-gateway/\">here</a>. We also secured our function with <code class=\"language-text\">auth</code> function that will be invoked before target function to check if supplied token is valid. <code class=\"language-text\">auth</code> function response is cached for 30 sec, the cache key is a <code class=\"language-text\">identitySource</code>. Usually when using proxy approach the whole request is forwarded to our function and configuration is as easy as</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">list</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> ajurasz.lambda.gallery.ListHandler\n    <span class=\"token key atrule\">events</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> gallery\n          <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> get</code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">delete</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> ajurasz.lambda.gallery.DeleteHandler\n    <span class=\"token key atrule\">events</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> gallery/<span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> delete\n          <span class=\"token key atrule\">authorizer</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> auth\n            <span class=\"token key atrule\">resultTtlInSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">identitySource</span><span class=\"token punctuation\">:</span> method.request.header.token</code></pre></div>\n<p>when we want to secure our endpoint.</p>\n<h2>Testing</h2>\n<p>With good encapsulation, you can test a lot. In my case, I only was not able to test Rekognition and DynamoDB services so had to use mocks. Recently (again, thank you Twitter) I found that <a href=\"https://github.com/allegro\">allegro tech team</a> open sourced <a href=\"https://github.com/allegro/embedded-elasticsearch\">embedded-elasticsearch</a> to make unit and integration testing easier and more reliable.</p>\n<h2>Deployment</h2>\n<p>This can obviously be a part of CI/CD pipeline as when everything is ready you need to execute just two commands</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./gradlew <span class=\"token function\">test</span>\nserverless deploy</code></pre></div>\n<p>this could be simplified to just one command by executing <code class=\"language-text\">serverless</code> command from within gradle task.</p>\n<h2>Conclusion</h2>\n<p>Personally, I wouldn’t consider building my whole application as functions from one simple reason - vendor locking (<a href=\"https://startupsventurecapital.com/firebase-costs-increased-by-7-000-81dc0a27271d\">this article</a> is kind of “lessons learned” type in terms of vendor locking). But this is a great option when you need to run some simple function triggered by different events somewhere on the web. There is still some lack in case of debugging (or I didn’t yet discover how to do it properly) these functions - at this point I will say only - <em>logger is your friend</em>.</p>","frontmatter":{"title":"Kotlin + AWS Lambda + Serverless Framework","date":"May 28, 2017"}}},{"node":{"fields":{"slug":"/2016-12-15-homemade-central-heating-temperature-monitoring/"},"html":"<p>Over the weekend I decided to once and for all resolve issue with boiling water in our central heating system. For people who don’t know what I’m writing about here, you will find nice <a href=\"https://www.plumber24hours.co.uk/plumber-blog/index.php/2013/01/05/solid-fuel/\">ilustration</a> that should make it clear. In my case the problem is that when I focus on something I forgot about the world around me and then after some time the sound of boiling water in pipes immediately pulls me out of my work and in few seconds I’m in the basement trying to resolve issue in different ways and this isn’t a pleasant operation. Please notice that this situation is very dangerous because boiling water can damage pipes and in few minutes your home can be flooded and repair costs probably will be very high.\nSolution to my issue would be replacing the old furnace with new one that can automatically take care of temperature adjustments, but I have got much more cheaper and more interensting solution for this one. </p>\n<!-- end -->\n<h2>Idea</h2>\n<p>My idea is to use <a href=\"https://en.wikipedia.org/wiki/ESP8266\">ESP8266</a> that will send temperature readings to <a href=\"https://www.cloudmqtt.com/\">MQTT broker</a> running in the cloud\nand then business logic will be handled by lightweight nodejs application running on <a href=\"https://dashboard.heroku.com/\">Heroku</a>. Logic is simple, display the current temperature in real time one web page using WebSocket protocol, expose REST endpoint with current temperature and send a notification to registered Android devices when the temperature is over 80 Celcius degrees. Registered devices will be stored in MongoDB hosted by <a href=\"https://mlab.com/\">mLab</a>. Here is top level architecture diagram:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/esp8266_remote_temperature_diagram-5e5d7d080fb98fe2e4801751713735c5-23935.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 690px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.55072463768116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACj0lEQVQoz2NgLF/Bwvz/PxNj2wEWxtJyBhhQv3OBRWxuDwdDsi8Lw7QOFoZ4Txbh6c0csjPqWUDyTCntTIy5s3gZE7uFGJN7hRiLFvIx5s1hZmBMn8TPYOojyRhSys+Yv0yQQa+ZjdtYl0fU11MIpPHOs+dNd548OXPz2YsuBtlpbPxxVSKsjAyCDGFLpJh6T/ADlQgAMTdj+0EuoIGyDIwhFZwM/KIKDHKK3IzZq8UYzFqFOOQlpLjlZGWBChnPv32/98Lbt/8PXrl5i0F9DQ+bW4w4CyeHDAOXiDSDhrkCY+hkCcacZYKMhXN4GPPnszIw5c3iZQqeJ8WUt4yPqXw2O8hVOv9/MgcAgwHEPvbju8bRL1+cbj1/aeVrMJWJr7Gai9/IAORtZpC8sE6YnLienQA8rCKBWIidSVqUgYEFJibWVs8uVFPKyoAFSM/o57D4/x9ZiAvB9GdgYHWYy86gOcGUwXgyH0xYYlIXq+Tkbk6RjgbW6FcP2Xb9/8+ScPIwu2RPK5vE5G4e2eZ6xlsPfjGC1M7adGTJrI0Hc0HsmRsPMTFM2XpbYNmhxzMXH3miCBJccPgRWKF4VxOr4rHdLBwmhgIsstKyPB4u3HKbVrACxVmqVAIZ/v//D1Z34+2X15eev18AZbMwfP7/X+rG/cf/Lz96bQMWfPmZSby5BtlLoHAVhIUZCNglFsANXH/0ws7VB87UgtjrDp5kZvgINPDizbv/z9x5ZgsSvPzkA5PUvGkMiif3MXA72aGEH2+AN4PswW3owcoNxJz//28GRyLD1Te/hG6/+rz93JPP2iD+2adfGLFFhomJCZhOSUlhA2Le5NQ0nqyECO6cWQe4jBoPSq2YXihXGefBDgACGNmIV03LbgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"esp8266_remote_temperature_diagram\"\n        title=\"\"\n        src=\"/static/esp8266_remote_temperature_diagram-5e5d7d080fb98fe2e4801751713735c5-23935.png\"\n        srcset=\"/static/esp8266_remote_temperature_diagram-5e5d7d080fb98fe2e4801751713735c5-09928.png 270w,\n/static/esp8266_remote_temperature_diagram-5e5d7d080fb98fe2e4801751713735c5-f0a87.png 540w,\n/static/esp8266_remote_temperature_diagram-5e5d7d080fb98fe2e4801751713735c5-23935.png 690w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Costs</h2>\n<p>Only costs I had to bear were for physical devices:</p>\n<ul>\n<li>ESP8266 bought <a href=\"http://allegro.pl/modul-sieciowy-wifi-esp8266-sterowanie-rs232-at-i5506834559.html\">here</a> for about 4$</li>\n<li>Converter USB UART/RS232 bought <a href=\"http://allegro.pl/konwerter-przejsciowka-usb-uart-rs232-pl2303hx-avr-i5734968614.html\">here</a> for about 1$</li>\n<li>DS18B20 digital temperature sensor bought <a href=\"http://allegro.pl/czujnik-temperatury-ds18b20-wodoodprony-przewod-1m-i5460123942.html\">here</a> for about 1,8 $</li>\n<li>Power supply bought <a href=\"http://allegro.pl/ladowarka-zasilacz-usb-5v-2a-kabel-mikrousb-i5903646901.html\">here</a> 4$</li>\n</ul>\n<p>Total: 10,8 $</p>\n<p>If it comes to MQTT broker, application and database hosting I’m using free plans as they are sufficient for my needs.</p>\n<h2>Implementation</h2>\n<p>Complete project can be found on <a href=\"https://github.com/ajurasz/RemoteTemperature\">github</a>. In this post, I will only focus on core parts of each component. So what are the components:</p>\n<ul>\n<li>ESP8226 device</li>\n<li>Nodejs application </li>\n<li>Android application</li>\n</ul>\n<p>Regarding <a href=\"https://iot.eclipse.org/resources/white-papers/Eclipse%20IoT%20White%20Paper%20-%20The%20Three%20Software%20Stacks%20Required%20for%20IoT%20Architectures.pdf\">Eclipse IoT White Paper</a> I would say that in my simple architecture ESP8266 act as both field device and gateway. Nodejs is an application that only performs business logic on data delivered by devices (in my case just one device). Android application is for the end user, where that user can check current temperature and be notified when the temperature is too high. </p>\n<h3>ESP8226</h3>\n<p>If it comes to ESP8266 there are two main things that you need to know when playing with this device. There are different wirings for deploying and running your program. When you want to deploy your program to the device you need to set up wirings in following way:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ESP8266_upload-25249e1fdd8758c1dcd6545a8021fe83-23526.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 1061px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.89066918001885%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACN0lEQVQoz32STWsTURSGZ+s/0I3uXLhSFMS9iFBx0YVYNxYEtUJBKGk3orhwVQUFNy4VlLZoG9NvmzRJk04mycxk8lGT2rQWirU0k6aaNOlHZh4nY5pGCz3wcuCee59zeM8VqoZBtWpgh2mwtJglEddQ5KidY6pCMhlH19ftK4Z13zBNW2ZT3pdAPQwT9N/bRLQ5AmEVjz9EQFLxizLT4QhJq9FRYTeyJMzEVixIlkHfPOnsGqFZGfe0yKRXxGtljzuI1z/LbGqJ4h7kCgXW8wXyW9sUyxXyv4qUd3YbYOHU5W6OnW7lfEsHaaeL+Rk/UZ+bQNCSc5CZoSG8zn5cAx959fodJ290cqLNwdmbHZy73cXx9iecaevk+rUWHI5uhJdvx3n0fIBbPT0kMl9RNY33A30MT4zg9nkZm/zChH+KzMICfZ4AF7ufceXxG1rb73LpjoMLXS+4+vApD+7fo7e398DDKc2DL+jn8ycn/R/6EAMic4kkmhIjFlfJb+gUKfFj62fdc7O+SPMfL4VqtWodWt7sbpAtfSeQFm24KzTCaHic4dAYrugo0nKUucI3NrYLfzkcgGrbrXFqEvbXXauXdyrEUwkiSoRgKEhUiSJFJEJqiMXVpcbjoyTUOpn1sQ3rP2bSGbSYRlgKo6kxlKiCrMmsrK00gM3g/5sIzYU9a+RUKoUsy4iiaH1u2QZLisTy6vIhYHNuePh/cXNzk1wuZyufz9tZ13XK5fIhQPO7SqVCqVTiD2QzC3rQ67XmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ESP8266_upload\"\n        title=\"\"\n        src=\"/static/ESP8266_upload-25249e1fdd8758c1dcd6545a8021fe83-23526.png\"\n        srcset=\"/static/ESP8266_upload-25249e1fdd8758c1dcd6545a8021fe83-3a5f7.png 270w,\n/static/ESP8266_upload-25249e1fdd8758c1dcd6545a8021fe83-ce49c.png 540w,\n/static/ESP8266_upload-25249e1fdd8758c1dcd6545a8021fe83-23526.png 1061w\"\n        sizes=\"(max-width: 1061px) 100vw, 1061px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>when you want to run your program, wirings should be set up in the following way (scheme contains temperature sensor connected to ESP8266):</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ESP8266_run-85801ae33ce503d5e02cee5724711ac0-649e4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 254px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 177.55905511811022%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFKElEQVRIx6WWC0yTVxTHvxlJ5jbMtgyK4txi1BCRMJ0axSDoptMtgsNA6GDKHB1DNAsCFXRE3uImVQSsQEUt47GBYCkSdDrUKkMEx0AYUoE6kJdM2sqj9PXf/T7aCTIQ6m1OvpMvp7/+z73n3FMKEyy9Xg+dTsf4EokEXC4X4eHhSExMhEaj+S/m+UVNBjR+kcfjgaIomJmZwc7ODmq1+uWAfD4f5ubmsLa2hpOT0/SBdOBoYFJyMmbNmgVLS0s4ODhANTw8Jm5KCumlVo8ABWmpDJDFYmGdoyONMk0h9DrQyR2IioP566/BiihcvmIlmtq7pqeQSVc7csIFN6thw94L1lYOLIjNc+VgX5LQGDh9YObV23jVbR/mfBUJK59DMPcMhXtcuukKc8oqMcczCHN3HISl9wFYsUPASTjzEsBrlZjvFQwLrzC8Q8ySzcWuoxmmALWMf5akTG3ZgyUBh7HAN5JJ3yU6zXSFuUThXJLyMv9ILNjGwcwPN8M1OMYQp5s6UGsAlpRXwzUwAgvYgVjkHYz3vLlgx5mg0AgsulkF593fY9V2HzhtccEq543wC4swPWUhXTbbg2Cz2hlr7G2xzNYGOznfTj9lI/AcAc5w+Q727ACs9/aDg8cu+EYmmK7w3G+VMHMLwmrucdgHJsAmIB7uR86OAxr9F5fNJQlmbNyFxX4xeNcnHNakwANP5Y0D0pcxbRMDNSNAQU4+KOslsPo6GiyvULzN3g/fxKwxwNFpv1DhadFlzHT4HAv9YhmFLNJ+HvEZo6phJC4rKwsRkRFTOZRKzP4iDA77eXDkHoNdQBzcYgXjgLwEHji+nBcrTL9SCYtPdmKTx3Z8tIMDJw8OXKP4Y1Mmn9rGOjRIGyYG6gz70qYYQElBCXjf7Aaf7GdR2S3cbmxhbm2jOsWTx0grKcXFX0STjwDjGEV3Jy4eiUevvO9/44aUfUjKKUVJqmjyEaAnQFqnqrUVuWQmpwgEEBeJUVBYCJFIxJhYXIy87Ezw839F6ZliUPTmjzWtwYhvGFJqmQwFUVGoaWiAamgIcrkcSqWSMblCgeF+BR4oARH//OQpGxetsDAmGi3t7RPGtPYbgIdPX0Os4Bpi0q8zzx/Jy/i0UsQIJIg6VYbOp0RlVwdRGI0motS4t8ZtGdlnHVqe0kDSBLNXhYBaGAZqETFbctVbsGD2/lbYuh7Fyg3+kJwSoiNXiOy4Q2hufzShQtkguepSC0FtYIeR2gqB594f8PHOeLy1aDPeXLEHTt7H4fLlQdyt+BPyinLkhIWivr4e+oEBDPb1YYic+LCyH4NyJfSKJ2jsHER+ghDUJtKbnr5B+GBbBOY6BmP5GmfM++w4Fvskw5Fc+eWJfHTkZCM7NBQ3Tp5EFzlZWX4e2gouoCEjBdKss+i+UABJlhjnT+SAWvppCNa6BWP+ei5eWRqIOWsD8Mb6Y5i3zg9r3SPQ2q1iUqqurcV9qXRMms13iqDoamJ8aY8KVbIBUJfLm0Hb1QopblY1Q3hJihTxAySn/Ywd/oeQX1iM62VlSEkmappGgBrDv686SRF6Hv7F+A1/K3Crvnd82fSrtMj/vQuXa7qReakW6eK7OFlYhfTiGojvkI6524Pi6m6U/NGL87eaybtHuFLXh59udOCeTAmKHkajjS6DQZUGyiEthklFqEmr0OVNP+kfezqkYZ6K/mF09SrQ1vkY3f8o0NnzBCqV6plC/ai2G9WEz9mzpdWo8VDWigfSJtTfq0PT/UbU1NTgX/I2rwVA5LL8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ESP8266_run\"\n        title=\"\"\n        src=\"/static/ESP8266_run-85801ae33ce503d5e02cee5724711ac0-649e4.png\"\n        srcset=\"/static/ESP8266_run-85801ae33ce503d5e02cee5724711ac0-649e4.png 254w\"\n        sizes=\"(max-width: 254px) 100vw, 254px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Main responsibilities of ESP8226 device are:</p>\n<ol>\n<li>establish and keep a connection to local network (to gain access to the internet) </li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;ESP8266WiFi.h></span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> wifi_ssid \"&lt;your ssid>\"</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> wifi_password \"&lt;ssid password>\"</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  WiFi<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span>wifi_ssid<span class=\"token punctuation\">,</span> wifi_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>WiFi<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> WL_CONNECTED<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WiFi connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"IP address: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>WiFi<span class=\"token punctuation\">.</span><span class=\"token function\">localIP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>read data from the temperature sensor</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;OneWire.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;DallasTemperature.h></span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ONE_WIRE_BUS 2</span>\n\nOneWire <span class=\"token function\">oneWire</span><span class=\"token punctuation\">(</span>ONE_WIRE_BUS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nDallasTemperature <span class=\"token function\">sensors</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>oneWire<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  sensors<span class=\"token punctuation\">.</span><span class=\"token function\">requestTemperatures</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">float</span> tempC <span class=\"token operator\">=</span> sensors<span class=\"token punctuation\">.</span><span class=\"token function\">getTempCByIndex</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"3\">\n<li>push readings to MQTT broker</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;ESP8266WiFi.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;PubSubClient.h></span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> mqtt_server \"&lt;server ip or hostname>\"</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> mqtt_port \"&lt;server port>\"</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> mqtt_user \"&lt;user name>\"</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> mqtt_password \"&lt;user password>\"</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> temperature_topic \"temperature/home/basement\"</span>\n\nWiFiClient espClient<span class=\"token punctuation\">;</span>\nPubSubClient <span class=\"token function\">client</span><span class=\"token punctuation\">(</span>espClient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  client<span class=\"token punctuation\">.</span><span class=\"token function\">setServer</span><span class=\"token punctuation\">(</span>mqtt_server<span class=\"token punctuation\">,</span> mqtt_port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">reconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">connected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Attempting MQTT connection...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ESP8266BasementClient\"</span><span class=\"token punctuation\">,</span> mqtt_user<span class=\"token punctuation\">,</span> mqtt_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed, rc=\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" try again in 5 seconds\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">connected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n  <span class=\"token punctuation\">}</span>\n  client<span class=\"token punctuation\">.</span><span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  client<span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span>temperature_topic<span class=\"token punctuation\">,</span> <span class=\"token string\">\"80.0\"</span><span class=\"token punctuation\">,</span> true<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Wait 30 seconds</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">30000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can run above snippets independently or combine them together. At this point I need to say that it was so easy only thanks to these great libraries (as I have basically no experience in C language):</p>\n<p><a href=\"https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WiFi\">ESP8266WiFi</a></p>\n<p><a href=\"https://github.com/knolleary/pubsubclient\">PubSubClient</a></p>\n<p><a href=\"https://github.com/milesburton/Arduino-Temperature-Control-Library\">DallasTemperature</a></p>\n<h3>Nodejs</h3>\n<p>I wanted to have something very light on the back end and to be able to host it for free so I decided to accomplish my requirements using nodejs which will run on Heroku. Another reason to choose Nodejs was that I wanted to check it out as I heard a lot of good about it. </p>\n<p>Main responsibilities of the Nodejs application:</p>\n<ol>\n<li>expose REST endpoints to handle device registration, update and delete:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/device'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> deviceName <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>deviceName<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> deviceId   <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>deviceId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> registrationId <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>registrationId<span class=\"token punctuation\">;</span>    \n\n    Device<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>deviceId <span class=\"token punctuation\">:</span> deviceId<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> devices<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>devices<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            Device<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                deviceName<span class=\"token punctuation\">:</span> deviceName<span class=\"token punctuation\">,</span>\n                deviceId<span class=\"token punctuation\">:</span> deviceId<span class=\"token punctuation\">,</span>\n                registrationId<span class=\"token punctuation\">:</span> registrationId\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>        \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/device'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> deviceId   <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>deviceId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> registrationId <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>registrationId<span class=\"token punctuation\">;</span>\n\n    Device<span class=\"token punctuation\">.</span><span class=\"token function\">findOneAndUpdate</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">{</span> deviceId<span class=\"token punctuation\">:</span> deviceId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n        <span class=\"token punctuation\">{</span> registrationId<span class=\"token punctuation\">:</span> registrationId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n        <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/device/:deviceId'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> deviceId   <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>deviceId<span class=\"token punctuation\">;</span>\n    Device<span class=\"token punctuation\">.</span><span class=\"token function\">findOneAndRemove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>deviceId <span class=\"token punctuation\">:</span> deviceId<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li>\n<p>expose WebSocket endpoint using <a href=\"https://www.npmjs.com/package/express-ws\">express-ws</a></p>\n</li>\n<li>\n<p>subscribe to MQTT topic and update <code class=\"language-text\">lastTemp</code> object with current temperature and notify registered devices if the temperature is above 80 degrees:</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">mqttClient<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>topic<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'received message %s %s'</span><span class=\"token punctuation\">,</span> topic<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n    lastTemp<span class=\"token punctuation\">.</span>temperature <span class=\"token operator\">=</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    aWss<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            topic<span class=\"token punctuation\">:</span> topic<span class=\"token punctuation\">,</span>\n            temperature<span class=\"token punctuation\">:</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>lastTemp<span class=\"token punctuation\">.</span>temperature<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">80.0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> message <span class=\"token operator\">=</span> <span class=\"token string\">'Warning temperature is very high '</span> <span class=\"token operator\">+</span> lastTemp<span class=\"token punctuation\">.</span>temperature <span class=\"token operator\">+</span> <span class=\"token string\">'°C'</span><span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span>lastUpdateDate<span class=\"token punctuation\">,</span> <span class=\"token string\">'minutes'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            gcm<span class=\"token punctuation\">.</span><span class=\"token function\">pushAll</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                lastUpdateDate <span class=\"token operator\">=</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>above was accomplished with <a href=\"https://www.npmjs.com/package/mqtt\">MQTT</a> and <a href=\"https://www.npmjs.com/package/fcm\">FCM</a> libraries. Documentation is very good even for Noob as I’m (in the case of Node.js) so no more explanation is required.</p>\n<h3>Android</h3>\n<p>For Android system, I created a simple widget which displays current temperature and is also able to receive messages from <a href=\"https://firebase.google.com/docs/cloud-messaging/\">\nFirebase Cloud Messaging</a> and display them as notifications. Because this is my first experience with Android SDK and I did all the research and implementation over the weekend I beat that there are better patterns for handling my requirements. Here are two screenshots of this application:</p>\n<ol>\n<li>widget</li>\n</ol>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/android_widget-e9e73577e9a8e2aaa4f0b1e1eab4f702-2152d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 346px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 177.74566473988438%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"android_widget\"\n        title=\"\"\n        src=\"/static/android_widget-e9e73577e9a8e2aaa4f0b1e1eab4f702-2152d.png\"\n        srcset=\"/static/android_widget-e9e73577e9a8e2aaa4f0b1e1eab4f702-5950c.png 270w,\n/static/android_widget-e9e73577e9a8e2aaa4f0b1e1eab4f702-2152d.png 346w\"\n        sizes=\"(max-width: 346px) 100vw, 346px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol start=\"2\">\n<li>notification</li>\n</ol>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/android_notification-661067bfd7d5360baed870f1284e362d-2152d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 346px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 177.74566473988438%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"android_notification\"\n        title=\"\"\n        src=\"/static/android_notification-661067bfd7d5360baed870f1284e362d-2152d.png\"\n        srcset=\"/static/android_notification-661067bfd7d5360baed870f1284e362d-5950c.png 270w,\n/static/android_notification-661067bfd7d5360baed870f1284e362d-2152d.png 346w\"\n        sizes=\"(max-width: 346px) 100vw, 346px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Integration with FCM was kind of tricky but <a href=\"https://firebase.google.com/docs/cloud-messaging/android/client\">“Set Up a Firebase Cloud Messaging Client App on Android”</a> article helped me a lot. It will take you step by step how to set up FCM client.</p>\n<h2>Future work</h2>\n<p>I will try to replace Nodejs application with application that use <a href=\"http://vertx.io/\">Vert.x</a> library.</p>","frontmatter":{"title":"Homemade central heating temperature monitoring","date":"December 15, 2016"}}},{"node":{"fields":{"slug":"/2016-11-02-watch-were-you-put-your-license-headers/"},"html":"<p>Recently when I was playing with creating <a href=\"https://www.docker.com/\">Docker</a> images I came across really strange error during creation of a container that doesn’t say much (not to me):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">standard_init_linux.go:175: <span class=\"token function\">exec</span> user process caused <span class=\"token string\">\"exec format error\"</span></code></pre></div>\n<!-- end -->\n<p>after some time spent on searching information about it, I started to rollback all changes done to Dockerfile one by one until I found failing part. The issue was with a shell script which was starting with license header instead of <a href=\"https://en.wikipedia.org/wiki/Shebang_(Unix)\">shebang</a> (i.e. <code class=\"language-text\">#!/bin/sh</code>).</p>\n<p>From Unix perspective this script is valid (in terms that it executes and print’s expected value on the screen):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"> <span class=\"token function\">cat</span> test.sh\n<span class=\"token comment\">#The MIT License (MIT)</span>\n<span class=\"token comment\">#Copyright (c) 2016 Arek Jurasz</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\">#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without #limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following #conditions:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\">#The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\">#THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO #EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR #THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>\n\n<span class=\"token comment\">#!/usr/sh (1)</span>\n\n<span class=\"token function\">ps</span> h -p $$ -o args<span class=\"token operator\">=</span><span class=\"token string\">''</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -f1 -d<span class=\"token string\">' '</span> <span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"Success\"</span></code></pre></div>\n<blockquote>\n<p>(1) inform OS what interpreter should be used for this script</p>\n</blockquote>\n<blockquote>\n<p>(2) finds what interpreter is used to execute script</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"> <span class=\"token function\">ls</span> -l\ntotal 8\n-rw-rw-r-- 1 arek arek   90 lis  2 10:55 Dockerfile\n-rwxrwxr-x 1 arek arek 1117 lis  2 10:56 test.sh\n\n ./test.sh\n/bin/sh\nSuccess</code></pre></div>\n<p>if we change (1) to <code class=\"language-text\">#!/bin/bash</code> the output is still the same:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"> ./test.sh\n/bin/sh\nSuccess</code></pre></div>\n<p>but we were expecting:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"> ./test.sh\n/bin/bash\nSuccess</code></pre></div>\n<p>this is not happening because <a href=\"https://en.wikipedia.org/wiki/Shebang_(Unix)\">shebang</a> is not in the first line and my OS is using default interpreter.</p>\n<h2>Conclusion</h2>\n<p><a href=\"https://www.docker.com/\">Docker</a> is more restrective if it comes to <a href=\"https://en.wikipedia.org/wiki/Shebang_(Unix)\">shebang</a> and it will fail to run your container if one of the scripts doesn’t starts with it. So be careful and don’t make the same mistakes I did.</p>","frontmatter":{"title":"Watch were you put your license headers","date":"November 2, 2016"}}},{"node":{"fields":{"slug":"/2015-11-16-bluetooth-scanner-on-raspberry-pi/"},"html":"<p>Do you want to know what bluetooth devices are in the range of your raspberry Pi unit and then act accordingly? Now it’s easier than ever before because with version 0.1.3 <a href=\"https://github.com/rhiot/rhiot/blob/master/docs/readme.md\">rhiot</a> comes with bunch of new IoT components and one of them is <a href=\"https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_bluetooth_component.html\">Camel Bluetooth component</a> which will allow you to list bluetooth devices working in surrounding area. There is also possibility to list services of given device if you want to know how to interact with it.</p>\n<!-- end -->\n<p><a href=\"https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_bluetooth_component.html\">Camel Bluetooth component</a> is a wrapper around <a href=\"http://www.bluecove.org\">bluecove</a> library. To work properly it require OS packages for handling bluetooth devices. By default it supports Ubuntu and Raspbian by installing <code class=\"language-text\">libbluetooth-dev</code> and <code class=\"language-text\">blueman</code> packages. With some configuration you can run it on OSX as well, please refer to <a href=\"https://rhiot.gitbooks.io/rhiotdocumentation/content/gateway/camel_components/camel_bluetooth_component.html\">Installation section</a>. You will also need to set dedicated installer (<code class=\"language-text\">io.rhiot.utils.install.BrewInstaller</code>) when working with OSX.</p>\n<h2>Create scanning endpoint</h2>\n<p>Following example demonstrate how easy it is to expose REST endpoint which will trigger bluetooth scanner. This code can be run on both pc and raspberry pi:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token function\">restConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"netty4-http\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">host</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">port</span><span class=\"token punctuation\">(</span><span class=\"token number\">8081</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">bindingMode</span><span class=\"token punctuation\">(</span>RestBindingMode<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">rest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/devices\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bluetooth://scan?serviceDiscovery=true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In above snipped we are doing two things, configuring <a href=\"http://camel.apache.org/netty4.html\">netty4 component</a> by setting host, port and binding mode. With binding mode set to <code class=\"language-text\">json</code> there is automatic conversion of <code class=\"language-text\">json</code> content to and from POJOs for all incoming and outgoing messages. Then <code class=\"language-text\">GET</code> endpoint was created with the <code class=\"language-text\">/api/devices</code> URI.</p>\n<p>Run application:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">java -jar target/scanner-pc-1.0-SNAPSHOT.jar</code></pre></div>\n<p>then</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> http://localhost:8081/api/devices</code></pre></div>\n<p>and formatted response should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arek\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"44D4E0AAA2B1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"bluetoothServices\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Advanced Audio\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btl2cap://44D4E0AAA2B1:0019;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OBEX Object Push\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btgoep://44D4E0AAA2B1:12;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Headset Gateway\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btspp://44D4E0AAA2B1:2;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Handsfree Gateway\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btspp://44D4E0AAA2B1:3;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OBEX Phonebook Access Server\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btgoep://44D4E0AAA2B1:19;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AV Remote Control Target\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btl2cap://44D4E0AAA2B1:0017;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AAS\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btspp://44D4E0AAA2B1:4;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Android Network Access Point\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"btl2cap://44D4E0AAA2B1:000f;authenticate=false;encrypt=false;master=false\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Bluetooth scanner on Raspberry Pi</h2>\n<p>Let’s get to the point and see example running on Raspberry Pi. Consider following scenario:</p>\n<ol>\n<li>Each time scanning is triggered blink yellow LED to indicate that application is running.</li>\n<li>Search device by it’s name.</li>\n<li>If device if found turn on geen LED</li>\n<li>If device is not found turn red LED</li>\n</ol>\n<p>Note: for 3 and 4 only one LED can be on.</p>\n<h4>Wiring</h4>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bluetooth-scanner-witing-3b3ae090a9f39281fe6e6b20af8d57c1-94372.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 15px -30px !important max-width: 651px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 105.3763440860215%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAUDAgT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAAbnm1mhWZncxiZtBr//EAB4QAAEEAQUAAAAAAAAAAAAAAAMBAhESABMUMTIz/9oACAEBAAEFAn9ZWWcGfQe7TAuuwyXHopIPP//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEBH/2gAIAQMBAT8B6GJF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPwHYxH//xAAZEAADAQEBAAAAAAAAAAAAAAAAARExEDL/2gAIAQEABj8CN43KeCpQaw3n/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARIUFRcYGR/9oACAEBAAE/IVTZ3H2a3AZ6KlbpPcE6jqb7wbl2lab5hA0UXP/aAAwDAQACAAMAAAAQI9dC/8QAGBEBAQEBAQAAAAAAAAAAAAAAAQAhMRH/2gAIAQMBAT8Qexh92JduC//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESEx/9oACAECAQE/EEDuHMRbi//EAB0QAQEBAQABBQAAAAAAAAAAAAERACExQWGRscH/2gAIAQEAAT8QUpiGE9ynlkipWvnJ2JI+qsMq3BRIo/G60CdX83c6oAsjgZQpU88dw52HKv3v/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Posts per blog\"\n        title=\"\"\n        src=\"/static/bluetooth-scanner-witing-3b3ae090a9f39281fe6e6b20af8d57c1-94372.jpg\"\n        srcset=\"/static/bluetooth-scanner-witing-3b3ae090a9f39281fe6e6b20af8d57c1-048bd.jpg 270w,\n/static/bluetooth-scanner-witing-3b3ae090a9f39281fe6e6b20af8d57c1-58c6d.jpg 540w,\n/static/bluetooth-scanner-witing-3b3ae090a9f39281fe6e6b20af8d57c1-94372.jpg 651w\"\n        sizes=\"(max-width: 651px) 100vw, 651px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>To assemble this schematic you will require:</p>\n<ul>\n<li>1 Raspberry Pi B+ (or 2)</li>\n<li>1 Breadbord</li>\n<li>3 LEDs</li>\n<li>3 220 ohms resistors</li>\n<li>7 Wires</li>\n</ul>\n<p>And here is the code to run on Raspberry Pi:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScannerRoute</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">RouteBuilder</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bluetooth://scan?consumer.delay=1000\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pi4j-gpio://1?mode=DIGITAL_OUTPUT&amp;state=LOW&amp;action=BLINK\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">choice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token function\">deviceWithName</span><span class=\"token punctuation\">(</span>DEVICE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">-</span><span class=\"token operator\">></span> p<span class=\"token punctuation\">.</span><span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>DEVICE_FOUND<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">otherwise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">-</span><span class=\"token operator\">></span> p<span class=\"token punctuation\">.</span><span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>DEVICE_NOT_FOUND<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">multicast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"direct:green\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"direct:red\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"direct:green\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span>exchange <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token function\">checkHeaderAndSetAction</span><span class=\"token punctuation\">(</span>DEVICE_FOUND<span class=\"token punctuation\">,</span> exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pi4j-gpio://2?mode=DIGITAL_OUTPUT&amp;state=LOW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"direct:red\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span>exchange <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token function\">checkHeaderAndSetAction</span><span class=\"token punctuation\">(</span>DEVICE_NOT_FOUND<span class=\"token punctuation\">,</span> exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pi4j-gpio://3?mode=DIGITAL_OUTPUT&amp;state=LOW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkHeaderAndSetAction</span><span class=\"token punctuation\">(</span>String headerKey<span class=\"token punctuation\">,</span> Exchange exchange<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span>headerKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>Pi4jConstants<span class=\"token punctuation\">.</span>CAMEL_RBPI_PIN_ACTION<span class=\"token punctuation\">,</span> GPIOAction<span class=\"token punctuation\">.</span>HIGH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>Pi4jConstants<span class=\"token punctuation\">.</span>CAMEL_RBPI_PIN_ACTION<span class=\"token punctuation\">,</span> GPIOAction<span class=\"token punctuation\">.</span>LOW<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this route few <a href=\"http://camel.apache.org/eip.html\">EIP</a> were used but I won’t explain them here as it’s out of the scope of this post. The flow is following:</p>\n<ol>\n<li>Consume results of a scanning.</li>\n<li>Blink yellow LED.</li>\n<li>Using predefined <code class=\"language-text\">Predicate</code> check if we found device with given name.</li>\n<li>Add extra header to message if device was found.</li>\n<li>Add extra header to message if device was not found.</li>\n<li>Route message to multiple endpoints.</li>\n<li>Examine message headers and depending on what you have found change pin action.</li>\n</ol>\n<h4>Final result</h4>\n<div>\n          <div\n            class=\"gatsby-resp-iframe-wrapper\"\n            style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\"\n          >\n            <iframe src=\"https://www.youtube.com/embed/pmYk7Yg13Lg?t=35s\" frameborder=\"0\" allowfullscreen style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          \"></iframe>\n          </div>\n          </div>\n<p>Source code can be found <a href=\"https://github.com/ajurasz/blog-samples\">here</a>.</p>\n<p>To build all modules you just need to execute from project directory</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./mvnw clean <span class=\"token function\">install</span></code></pre></div>\n<p>notice that I’m writing maven pom in groovy so if you want you can convert <code class=\"language-text\">pom.groovy</code> to <code class=\"language-text\">pom.xml</code> with following command</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./mvnw io.takari.polyglot:polyglot-translate-plugin:translate</code></pre></div>","frontmatter":{"title":"Bluetooth scanner on Raspberry Pi","date":"November 16, 2015"}}}],"pathPrefix":"","first":false,"last":true,"index":2,"pageCount":2,"additionalContext":{}}}
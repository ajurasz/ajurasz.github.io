<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="google-site-verification" content="CcQWHZSra56gJoiG2L4xv8GjL2z_C1txoouzKlR4ASk"/><style data-href="/styles.d58a854661ffccf3756e.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.26.1"/><style data-styled="bvxbLs cdEpUV iSYTTb gDybXa dIQAlg cMSLWU ijxtcw iQIAOc dmFQlA hGedeg cpnbXC ipkTNK eNlzGc ukmsj bGukrS iMnMOA cLxazo iJKMsj cBVFwB fDOfVi eAaXEV" data-styled-version="4.4.1">
/* sc-component-id: sc-bdVaJa */
.cBVFwB{color:#3e465b;font-size:22px;font-weight:700;line-height:1.5;margin:25px 50px 15px;}
/* sc-component-id: sc-global-3434470545 */
@import url("https://fonts.googleapis.com/css?family=Roboto:400,700"); html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} *,*:before,*:after{box-sizing:inherit;} html{font-size:62.5%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;box-sizing:border-box;} body{background:#f9fafc;font-family:'Open Sans',sans-serif;line-height:1.5;padding:50px 0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;} img{max-width:100%;} .gatsby-highlight{border-bottom:1px solid #e0e6ed;border-top:1px solid #e0e6ed;margin:15px -100px;padding:0;} .gatsby-highlight pre[class*="language-"]{margin:0;padding:25px 100px;} pre[class*="language-"]{background:rgba(245,245,245,1);color:rgb(65,76,94);} @media only screen and (max-width:870px){.gatsby-highlight{margin:15px -15px;}.gatsby-highlight pre[class*="language-"]{padding:25px;}}
/* sc-component-id: sc-htpNat */
.bvxbLs{margin:0 auto;max-width:1080px;}
/* sc-component-id: sc-ifAKCX */
.cMSLWU{margin-top:15px;text-align:center;}
/* sc-component-id: sc-EHOje */
.ijxtcw{border:1px solid #bfc8d2;border-radius:15px;color:#3e465b;display:inline-block;margin:5px;padding:5px 10px;-webkit-text-decoration:none;text-decoration:none;} .ijxtcw svg{display:inline-block;height:20px;stroke:#6e849c;vertical-align:middle;width:20px;} .ijxtcw:hover{border-color:#3e465b;}
/* sc-component-id: sc-bZQynM */
.iSYTTb{color:#3e465b;font-size:35px;line-height:1.5;margin:0;padding:0 30px;text-align:center;}
/* sc-component-id: sc-gzVnrw */
.ipkTNK{color:#666d71;display:block;font-size:1.6em;margin:50px 0 0 0;text-align:center;}
/* sc-component-id: sc-htoDjs */
.dIQAlg{color:#666d71;display:block;font-size:1.6em;margin:50px 0 0 0;text-align:center;margin:0;}
/* sc-component-id: sc-dnqmqq */
.gDybXa{color:#3498db;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: sc-iwsKbI */
.cdEpUV{margin:0 auto;max-width:650px;padding:0 50px 50px;text-align:center;}
/* sc-component-id: sc-gZMcBi */
.cLxazo{color:#65738c;font-size:16px;} .cLxazo a{color:#3498db;font-weight:700;-webkit-text-decoration:none;text-decoration:none;} .cLxazo a:hover{-webkit-text-decoration:underline;text-decoration:underline;} .cLxazo h1{color:#3e465b;font-size:30px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h2{color:#3e465b;font-size:22px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h3{color:#3e465b;font-size:17px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h4{color:#3e465b;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h5,.cLxazo h6{color:#3e465b;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo p{line-height:1.7;margin:15px 50px;} .cLxazo blockquote{border-left:5px solid #e0e6ed;line-height:1.7;margin:15px 50px 15px 75px;padding:10px 10px 10px 15px;} .cLxazo blockquote p{margin:0;} .cLxazo ul,.cLxazo ol{line-height:1.7;margin:15px 0;padding:0 50px 0 100px;} .cLxazo ul p,.cLxazo ol p,.cLxazo ul ul,.cLxazo ol ul,.cLxazo ul ol,.cLxazo ol ol{margin:0;} .cLxazo ul ul,.cLxazo ol ul,.cLxazo ul ol,.cLxazo ol ol{padding:0 0 0 30px;} .cLxazo img{margin:15px 0;}
/* sc-component-id: sc-gqjmRU */
.iMnMOA h1{color:#3e465b;font-size:35px;line-height:1.5;margin:0;padding:0 30px;text-align:center;} .iMnMOA p{color:#666d71;display:block;font-size:1.6em;margin:0;text-align:center;} .iMnMOA span{background:#9c9da3;display:block;margin:50px auto;height:1px;width:150px;}
/* sc-component-id: sc-VigVT */
.bGukrS{border:1px solid #bfc8d2;border-radius:25px;color:#3e465b;display:inline-block;font-size:10px;font-weight:700;margin:0 10px;padding:5px 15px;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;} .bGukrS:hover{border-color:#000;}
/* sc-component-id: sc-jTzLTM */
.iQIAOc{background:#fff;border:1px solid #e0e6ed;box-shadow:0 1px 5px rgba(0,0,0,0.05);margin-bottom:30px;padding:75px 100px;} @media only screen and (max-width:870px){.iQIAOc{border-left:none;border-right:none;padding:75px 15px;}}
/* sc-component-id: sc-jzJRlG */
.eAaXEV{margin-top:50px;text-align:center;}
/* sc-component-id: sc-cSHVUG */
.iJKMsj{margin-top:50px;text-align:center;}
/* sc-component-id: sc-kAzzGY */
.fDOfVi{border:1px solid #bfc8d2;border-radius:15px;display:inline-block;margin:5px;padding:5px 15px;-webkit-text-decoration:none;text-decoration:none;} .fDOfVi svg{display:inline-block;height:20px;stroke:#6e849c;vertical-align:middle;width:20px;} .fDOfVi:hover{border-color:#3e465b;}
/* sc-component-id: sc-chPdSV */
.ukmsj{margin-top:50px;text-align:center;}
/* sc-component-id: sc-kgoBCf */
.dmFQlA{text-align:center;}
/* sc-component-id: sc-kGXeez */
.hGedeg{color:#3e465b;-webkit-text-decoration:none;text-decoration:none;} .hGedeg:hover{color:#3498db;}
/* sc-component-id: sc-kpOJdX */
.cpnbXC{color:#666d71;display:block;font-size:1.6em;margin:0;text-align:center;}
/* sc-component-id: sc-dxgOiQ */
.eNlzGc{color:#666d71;display:inline-block;font-size:14px;margin-top:50px;-webkit-text-decoration:none;text-decoration:none;} .eNlzGc:hover{color:#3498db;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=b20963e5386fbe2d3f9a949aa901ab35" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3498db"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><title data-react-helmet="true">Use JDK Flight Recorder to log SQL queries | Arek Jurasz</title><meta data-react-helmet="true" name="description" content="Dev Blog | Software Engineer"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/d8c6fceef6035ce68615adfef14ec1b550203772-14413fc1ec31b5870784.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js"/><link as="script" rel="preload" href="/2ca085fac04eec258979fa96688fdd6e5c5ad72a-f00de00f4547757df859.js"/><link as="script" rel="preload" href="/app-521958764a070b5830bc.js"/><link as="script" rel="preload" href="/styles-7d4153d260c0197f0043.js"/><link as="script" rel="preload" href="/webpack-runtime-ee94d47a64541c0394a1.js"/><link as="fetch" rel="preload" href="/page-data/2020-12-07-use-jdk-flight-recorder-to-log-sql-queries/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><link rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAADbmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmjX/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uaNf/bmTP/2pUq/9uZM//bmjT/25o1/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25o1/9ybN//alSv/25o1/+KtXP/bmDL/2pYt/9qVK//cmzb/25o1/9uZM//bmTP/25kz/9uZM//bmTP/25o0/9qVK//YjyD/36RJ/+W1bf/25s//3J07/+CoUv/irFv/2JAh/9mUKP/bmTT/25kz/9uZM//bmTP/25k0/9qVLP/hqVT/8tq3///////pwob/8tq1/+OvYf/ksmb///////Xjyf/jsWX/2pYt/9uZM//bmTP/3Js2/9mTJ//uz6H///////DUq//eo0j/1owZ/+7Nnf/tzJr/140b/9ydPP/syJP///////ThxP/aliz/25o0/9uaNf/alSv/57t5//nv4P/25s//68eR/9ybOP/ltGv/896//9qWL//pwIP/9eLG//nw4//rx5H/2pYu/9uaNP/bmTP/25o0/9mTKP/blzH/57t4//rx5f/ty5n/3Js3//Xjyf/pwYX/+/Tq/+rDif/cnDn/2ZIl/9uZNP/bmTP/25kz/9uZM//bmjX/25kz/9iRJP/ZlCr/3Z9A/9mUKf/z38D/5bRs/9iRJf/YkST/25gx/9yaNv/bmTP/25kz/9uZM//bmTP/25kz/9uZM//cmjb/25o0/9uYMP/bmDH/3Z4//9ybOf/bmDH/3Js3/9uZNP/bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTT/25kz/9uYMP/bmDH/25k0/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTT/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><section class="sc-htpNat bvxbLs"><header class="sc-iwsKbI cdEpUV"><h1 class="sc-bZQynM iSYTTb"><a class="sc-dnqmqq gDybXa" href="/">Arek Jurasz</a></h1><p class="sc-gzVnrw sc-htoDjs dIQAlg">Software Engineer</p><div class="sc-ifAKCX cMSLWU"><a href="https://twitter.com/arekjurasz" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://github.com/ajurasz" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/arkadiusz-jurasz/" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://ajurasz.github.io/rss.xml" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></header></section><section class="sc-htpNat bvxbLs"><div class="sc-jTzLTM iQIAOc"><div class="sc-gqjmRU iMnMOA"><h1>Use JDK Flight Recorder to log SQL queries</h1><p>December 07, 2020</p><span></span></div><article class="sc-gZMcBi cLxazo"><div><p>Since Java 11, <code class="language-text">JDK Flight Recorder</code> (<code class="language-text">JFR</code>) is getting more and more popular among developers. There are two reasons behind this fact, first, <code class="language-text">JFR</code> got open-sourced and included into OpenJDK - previously it was part of a <code class="language-text">JRockit JVM</code> and commercial version of Oracle JDK (see <a href="http://openjdk.java.net/jeps/328">JEP 328</a> for more details.). The second fact is that it is a tool for collecting diagnostic and profiling data about running Java application - because it is so deeply embedded to JVM it provides extremely low overhead (about 1% out of the box).</p>
<!-- end -->
<h2>Low overhead</h2>
<p>To get a very good and affordable explanation on how JVM engineers managed to achieve so great results, please watch part of the following video where Mikael Vidstedt explains this.</p>
<div class="gatsby-resp-iframe-wrapper" style="padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem" > <iframe src="https://www.youtube.com/embed/plYESjZ12hM?t=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style=" position: absolute; top: 0; left: 0; width: 100%; height: 100%; "></iframe> </div>
<blockquote>
<p>I encourage you to watch the full presentation as it is very enlightening in terms of <code class="language-text">JFR</code> topic.</p>
</blockquote>
<h2>JFR</h2>
<p>If videos are not your thing and you prefer to read then I recommend following blog posts from <code class="language-text">redhat</code>:</p>
<ul>
<li><a href="https://developers.redhat.com/blog/2020/08/25/get-started-with-jdk-flight-recorder-in-openjdk-8u/">Get started with JDK Flight Recorder in OpenJDK 8u</a></li>
<li><a href="https://developers.redhat.com/blog/2020/10/29/collect-jdk-flight-recorder-events-at-runtime-with-jmc-agent/">Collect JDK Flight Recorder events at runtime with JMC Agent</a></li>
</ul>
<h2>Motivation</h2>
<p>I got inspired by Gunnar Morling and his tweet</p>
<blockquote class="twitter-tweet" align="center" data-dnt="true"><p lang="en" dir="ltr">🧑‍💻: &quot;If we only could log SQL statements executed by <a href="https://twitter.com/Hibernate?ref_src=twsrc%5Etfw">@Hibernate</a> with Flight Recorder.&quot;<br><br>JMC Agent: &quot;Hold my 🍷!&quot; <a href="https://t.co/f5S5hSf5Tj">pic.twitter.com/f5S5hSf5Tj</a></p>&mdash; Gunnar Morling 🌍 (@gunnarmorling) <a href="https://twitter.com/gunnarmorling/status/1317552923950391301?ref_src=twsrc%5Etfw">October 17, 2020</a></blockquote>

<p>Although it’s not visible on the Gunnar’s screen if he logs SQL statements together with parameters I thought it would be a great exercise to see if I could do the similar thing using <code class="language-text">JFR</code> and have full SQL statements that can be copy-pasted to an SQL editor.</p>
<h2>Datasource proxy</h2>
<p>First, to be able to get access to SQL statements and parameters passed to JDBC it would be required to intercept appropriate methods from JDBC API through a proxy around <code class="language-text">java.sql.Statement</code>. To make things easier and focus mostly on creating <code class="language-text">jdk.jfr.Event</code>s we will use <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> - library which gives easy access to what is needed.</p>
<p>Let’s start wit creating <code class="language-text">javax.sql.DataSource</code> and tell HIbernate to use it.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">object</span> DB <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> sessionFactory<span class="token operator">:</span> SessionFactory

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> registry <span class="token operator">=</span> <span class="token function">StandardServiceRegistryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">applySettings</span><span class="token punctuation">(</span><span class="token function">runtimeSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        sessionFactory <span class="token operator">=</span> <span class="token function">MetadataSources</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addAnnotatedClass</span><span class="token punctuation">(</span>Post<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">buildMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">buildSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">runtimeSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> MutableMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">mutableMapOf</span><span class="token punctuation">(</span>
                Environment<span class="token punctuation">.</span>DATASOURCE <span class="token keyword">to</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> ProxyDataSourceBuilder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">listener</span><span class="token punctuation">(</span><span class="token function">QueryRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">MysqlDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span><span class="token function">setURL</span><span class="token punctuation">(</span><span class="token function">dbUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        it<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token function">dbUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        it<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token function">dbPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// rest of the code omitted for better readability    </span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p>Hibernate is used only to make this example more interesting. It would be possible to use raw JDBC API and work directly with <code class="language-text">java.sql.Connection</code> and <code class="language-text">java.sql.PreparedStatement</code>.</p>
</blockquote>
<p>Notice that <code class="language-text">ProxyDataSourceBuilder</code> register <code class="language-text">QueryRecorder</code> listener that will be executed after a call to one of the following methods <code class="language-text">executeQuery, executeUpdate, execute, executeLargeUpdate</code> from <code class="language-text">java.sql.Statement</code>. <code class="language-text">QueryRecorder#afterQuery</code> is responsible for parsing provided arguments through the <code class="language-text">Query</code> object and then commit <code class="language-text">JFR</code> events.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> QueryRecorder <span class="token operator">:</span> QueryExecutionListener <span class="token keyword">by</span> QueryExecutionListener<span class="token punctuation">.</span><span class="token function">DEFAULT</span> <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">afterQuery</span><span class="token punctuation">(</span>execInfo<span class="token operator">:</span> ExecutionInfo<span class="token operator">?</span><span class="token punctuation">,</span> queryInfoList<span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>QueryInfo<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolveQuery</span><span class="token punctuation">(</span>queryInfoList<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token operator">::</span>publishEvent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">resolveQuery</span><span class="token punctuation">(</span>queryInfoList<span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>QueryInfo<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span> queryInfoList
            <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>parametersList<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> params <span class="token operator">-></span> <span class="token function">Pair</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token operator">-></span> Query<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">QueryEvent</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">toSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Collecting JFR events</h2>
<p>There are three ways to “record flights”.</p>
<ol>
<li>JDK Mission Control (JMC)</li>
</ol>
<p>The main purpose of this tool is to analyze <code class="language-text">JFR</code> recordings through a graphical interface. Beside displaying these data it can interact with <code class="language-text">JFR</code> to start recordings. Assuming there is a running Java application supporting <code class="language-text">JFR</code>, then we can select process under which this application runs and start recording as shown below.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/940e4190af458a27a356c75ceee8677e/e0202/jmc_1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin: 15px -30px !important max-width: 700px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 61.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAC4jAAAuIwF4pT92AAAB+klEQVQoz6WS22sTQRTG9+8WCoLgpTYgNvdoW4oVq29aLaJP6rukKGi21jQ2yc7eL7OXZLd8frObhGhFH1z2x5mdOXxzvnNWa9braGxvo05ajQa67XZJp9VCu9lAh+u93T3s7uyg2+nwm3R+pbuID3s9aGmSwJcx5CxHVlzif558PodmnX3F6P0xTl4+xcnRIfrPn6D/QnGIz6+eQf/wFsPhEMOzbzjVB1c4O9VhiymiKITvedDmicRY/4LN6xu4tXEN927eQKu2iebWHTTv3saD+n08PjjAo/199GhrSXdhsVbbwrs3r1EUOcLAhzabzSCTFC7VXT9AKCUitiGKE65jxhgqZ047eZ6vKIqitDm1bIwuxkhZWBQGFMwyhFyMJz/gOTYsy4LrukgomiQxYgpKXvI76jxNU1qN4DE/lhEFQ2hZxk0mjC7O8Z19UoIZL1ln9geqs7SMVwRVFQ6FhDGF5Drm7Sr+i2We6zoLwUAJZuWEjOkEtl1ZVjEMIxL+FZU3ZRGWZa4LVn0whQHHceB5bjn+Jd4K7vs+giDggKohXeYcDN+Qw5QsSsEpZ0wKadeAS0G7rNCqIm9We3Esywrkok9qiJIOhCfwcdLHSJwjpfWqwjQpLQsh4KyE1jFhmaLEZI5BixO2xzQEBqMBjj4dQx/ryNRvRsGfbQVq9y+BlR4AAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="JMC Start Recording"
        title=""
        src="/static/940e4190af458a27a356c75ceee8677e/8c557/jmc_1.png"
        srcset="/static/940e4190af458a27a356c75ceee8677e/4edbd/jmc_1.png 175w,
/static/940e4190af458a27a356c75ceee8677e/13ae7/jmc_1.png 350w,
/static/940e4190af458a27a356c75ceee8677e/8c557/jmc_1.png 700w,
/static/940e4190af458a27a356c75ceee8677e/e996b/jmc_1.png 1050w,
/static/940e4190af458a27a356c75ceee8677e/e0202/jmc_1.png 1395w"
        sizes="(max-width: 700px) 100vw, 700px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>There are two important things to be aware of while configuring recording (this applies to other two ways as well). First is that there are two types of recordings <code class="language-text">Time fixed</code> where we define the time of recording and <code class="language-text">Continuous</code> where we define the maximum size and age of these recordings. <code class="language-text">Time fixed</code> is very nice to sample your Java application once for a given time and then when recording is finished <code class="language-text">JMC</code> will automatically load and display collected data - for <code class="language-text">Continuous</code> type you would have to manually dump recordings to a file and then load them in <code class="language-text">JMC</code>.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/a800e86e0f352147257682043e0a76fd/82f50/jmc_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin: 15px -30px !important max-width: 700px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 51.42857142857144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB60lEQVQoz11SWW7bQAzV/Q9Qp6mX2jKSK+QA7U83tEWMNtW+ebRZtjbLWqxXcmwHRQd4IIcaPj6SUt5OJpi8meCO7Gw6xZRwf/8Os9kc8/lc2oeHR4nFYgF1pWKtqlAJ6/X6AnWF5XKJx9V7KG1ToywLHI9H8MkPOfIsQ991aNuObA+MI8bziP9PR9/6/oxx6GX+qRug5IcMuvZCgQZDPyDwHGx9j4j3CCwDgalDOCb5OkLXhiCEVwjHwtY2kYUCeRKRkBQKMzuui6ZpZNX0+RPCj08YXr5SsgMv2CJJU9iOg3S3gx8EMC1L5rieB8u2UdX1VXEHhdv9o2nY7/cyKHwTm2+fkacJxDaARclRFELXdcRRBI+I2DdNE6ZhQKPc+krIY1KqqoRhaNTiQQazQwzdMhEfSggRwiFlcRxLAra+79N7Q965GPsRFWJBzKFU1LLhuCiaVhImwpMKmtMJAbV3IYxeCTlmkH8jvRHrdA+FoJZjauvLB6S/vuOc+MgoaFs2TrRhfnBpOZIETOjR3F4VErh4VVVSTNu2tJSQFqL9QG/8xOD8RrILsdk8wxMRttTyv4RsXZohz+2mTNN0FEVxXQoRtvSr8DkTRjnDXKooqxopbZdnxpZjO9qyINVMynEGb7ssy4tCGtNfFuzaGzOGL90AAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="JMC Recording Results"
        title=""
        src="/static/a800e86e0f352147257682043e0a76fd/8c557/jmc_2.png"
        srcset="/static/a800e86e0f352147257682043e0a76fd/4edbd/jmc_2.png 175w,
/static/a800e86e0f352147257682043e0a76fd/13ae7/jmc_2.png 350w,
/static/a800e86e0f352147257682043e0a76fd/8c557/jmc_2.png 700w,
/static/a800e86e0f352147257682043e0a76fd/e996b/jmc_2.png 1050w,
/static/a800e86e0f352147257682043e0a76fd/2cefc/jmc_2.png 1400w,
/static/a800e86e0f352147257682043e0a76fd/82f50/jmc_2.png 1635w"
        sizes="(max-width: 700px) 100vw, 700px"
      />
    </span>
  </span>
  
  </a>
    </p>
<blockquote>
<p><strong>SQL statements provided by JFR Events</strong></p>
</blockquote>
<blockquote>
<p>select next<em>val as id</em>val from hibernate_sequence for update</p>
</blockquote>
<blockquote>
<p>update hibernate<em>sequence set next</em>val= 6 where next_val=5</p>
</blockquote>
<blockquote>
<p>insert into Post (content, createDate, title, id) values (‘Some content 0dfbf216-4e93-46cd-8f2f-25999e7114bd’, ‘2020-12-342 22:12:75’, ‘Post #1’, 1)</p>
</blockquote>
<blockquote>
<p>insert into Post (content, createDate, title, id) values (‘Some content e23c1061-95f4-4960-a484-90e3483165e7’, ‘2020-12-342 22:12:09’, ‘Post #2’, 2)</p>
</blockquote>
<blockquote>
<p>insert into Post (content, createDate, title, id) values (‘Some content c102d6c3-a070-466f-9ff4-44cc69bb20d0’, ‘2020-12-342 22:12:14’, ‘Post #3’, 3)</p>
</blockquote>
<blockquote>
<p>insert into Post (content, createDate, title, id) values (‘Some content 5c7c2083-68ec-4b1d-b911-95942facddb0’, ‘2020-12-342 22:12:19’, ‘Post #4’, 4)</p>
</blockquote>
<blockquote>
<p>insert into Post (content, createDate, title, id) values (‘Some content a8118b5b-f3d4-4fa5-b796-01a33f79bab4’, ‘2020-12-342 22:12:23’, ‘Post #5’, 5)</p>
</blockquote>
<p>The second important thing I mentioned that it is worth to notice is that we can define <code class="language-text">Event settings</code> - file which allows customizing what events are record and how often. By default, OpenJDK 11 provides two setting files</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">jdk11
  ├── bin
  ├── conf
  ├── demo
  ├── include
  ├── jmods
  ├── legal
  ├── lib
  │   └── jfr
  │       ├── default.jfc
  │       └── profile.jfc
  ├── <span class="token function">man</span>
  └── release</code></pre></div>
<p><strong><code class="language-text">default.jfc</code></strong> - “Low overhead configuration safe for continuous use in production environments, typically less than 1 % overhead.”</p>
<p><strong><code class="language-text">profile.jfc</code></strong> - “Low overhead configuration for profiling, typically around 2 % overhead.”</p>
<p>If we would like to ignore for instance <code class="language-text">QueryEvent</code> from recordings we could disable it through <code class="language-text">jfc</code> file like this:</p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- Rest of the file ommited for better readability --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>event</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>io.ajurasz.QueryEvent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enabled<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>setting</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>event</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>  </code></pre></div>
<ol start="2">
<li>JVM</li>
</ol>
<p>It is possible to enable recording at process startup using <code class="language-text">-XX:StartFlightRecording</code> JVM option. Following command will dump recordings on exit to a file named <code class="language-text">sample.jfr</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">java -XX:StartFlightRecording<span class="token operator">=</span>disk<span class="token operator">=</span>true,dumponexit<span class="token operator">=</span>true,filename<span class="token operator">=</span>sample.jfr -jar target/hibernate-logging-1.0-SNAPSHOT-jar-with-dependencies.jar</code></pre></div>
<p>Above option is so nice that it additionally prints instruction in the console on how to dump recording to a file on demand (if we don’t want to wait until process exits):</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">➜  hibernate-jfr-logging git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> ✗ java -XX:StartFlightRecording<span class="token operator">=</span>disk<span class="token operator">=</span>true,dumponexit<span class="token operator">=</span>true,filename<span class="token operator">=</span>sample.jfr -jar target/hibernate-logging-1.0-SNAPSHOT-jar-with-dependencies.jar
Started recording <span class="token number">1</span>. No limit specified, using <span class="token assign-left variable">maxsize</span><span class="token operator">=</span>250MB as default.

Use jcmd <span class="token number">24288</span> JFR.dump <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token number">1</span> to copy recording data to file.
Dec 07, <span class="token number">2020</span> <span class="token number">9</span>:26:23 PM org.hibernate.Version logVersion
INFO: HHH000412: Hibernate ORM core version <span class="token punctuation">[</span>WORKING<span class="token punctuation">]</span>
Dec 07, <span class="token number">2020</span> <span class="token number">9</span>:26:23 PM org.hibernate.annotations.common.reflection.java.JavaReflectionManager <span class="token operator">&lt;</span>clinit<span class="token operator">></span>
INFO: HCANN000001: Hibernate Commons Annotations <span class="token punctuation">{</span><span class="token number">5.1</span>.0.Final<span class="token punctuation">}</span>
Dec 07, <span class="token number">2020</span> <span class="token number">9</span>:26:24 PM org.hibernate.dialect.Dialect <span class="token operator">&lt;</span>init<span class="token operator">></span>
<span class="token punctuation">..</span>.</code></pre></div>
<ol start="3">
<li>jcmd</li>
</ol>
<p><code class="language-text">jcmd</code> utility is used to send diagnostic command requests to the JVM. Some of the commands are designed to control <code class="language-text">JFR</code> in a running process. Following commands shows how to start, dump and stop recording:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">➜  hibernate-jfr-logging git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> jcmd <span class="token number">25024</span> JFR.start <span class="token assign-left variable">name</span><span class="token operator">=</span>MyRecording
➜  hibernate-jfr-logging git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> jcmd <span class="token number">25024</span> JFR.dump <span class="token assign-left variable">filename</span><span class="token operator">=</span>sample.jfr
➜  hibernate-jfr-logging git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> jcmd <span class="token number">25024</span> JFR.stop <span class="token assign-left variable">name</span><span class="token operator">=</span>MyRecording</code></pre></div>
<h2>Conclusion</h2>
<p><code class="language-text">JFR</code> looks to be a great tool for troubleshooting errors occurring on production, especially that it does not require to restart already running application.</p>
<p>Source code of the sample application that logs full SQL statements can be found on <a href="https://github.com/ajurasz/hibernate-jfr-logging">github</a>.</p></div></article><div class="sc-cSHVUG iJKMsj"><h2 class="sc-bdVaJa cBVFwB">Share This Post</h2><a href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank" aria-label="Share on Facebook" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a><a href="https://twitter.com/intent/tweet?text=Use%20JDK%20Flight%20Recorder%20to%20log%20SQL%20queries&amp;url=" target="_blank" aria-label="Share on Twitter" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=&amp;title=Use%20JDK%20Flight%20Recorder%20to%20log%20SQL%20queries" target="_blank" aria-label="Share on LinkedIn" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="mailto:?subject=Use%20JDK%20Flight%20Recorder%20to%20log%20SQL%20queries&amp;body=" aria-label="Share by Email" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></div></div><div class="sc-jzJRlG eAaXEV"><a rel="prev" class="sc-VigVT bGukrS" href="/2020-11-23-aws-lambda-custom-runtime/">← <!-- -->AWS Lambda custom runtime</a></div></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-70225806-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020-12-07-use-jdk-flight-recorder-to-log-sql-queries/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-303683f6c6a5fb752dca.js"],"app":["/app-521958764a070b5830bc.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-36dc033f967ae9fe9cda.js"],"component---src-pages-404-js":["/component---src-pages-404-js-eb0bdeafcc9777c65a54.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js"],"component---src-templates-index-js":["/component---src-templates-index-js-d11899b60a8ffb21d9d4.js"]};/*]]>*/</script><script src="/polyfill-303683f6c6a5fb752dca.js" nomodule=""></script><script src="/webpack-runtime-ee94d47a64541c0394a1.js" async=""></script><script src="/styles-7d4153d260c0197f0043.js" async=""></script><script src="/app-521958764a070b5830bc.js" async=""></script><script src="/2ca085fac04eec258979fa96688fdd6e5c5ad72a-f00de00f4547757df859.js" async=""></script><script src="/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js" async=""></script><script src="/d8c6fceef6035ce68615adfef14ec1b550203772-14413fc1ec31b5870784.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script></body></html>
<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="google-site-verification" content="CcQWHZSra56gJoiG2L4xv8GjL2z_C1txoouzKlR4ASk"/><style data-href="/styles.d58a854661ffccf3756e.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.26.1"/><style data-styled="bvxbLs cdEpUV iSYTTb gDybXa dIQAlg cMSLWU ijxtcw iQIAOc dmFQlA hGedeg cpnbXC ipkTNK eNlzGc ukmsj bGukrS iMnMOA cLxazo iJKMsj cBVFwB fDOfVi eAaXEV" data-styled-version="4.4.1">
/* sc-component-id: sc-bdVaJa */
.cBVFwB{color:#3e465b;font-size:22px;font-weight:700;line-height:1.5;margin:25px 50px 15px;}
/* sc-component-id: sc-global-3434470545 */
@import url("https://fonts.googleapis.com/css?family=Roboto:400,700"); html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} *,*:before,*:after{box-sizing:inherit;} html{font-size:62.5%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;box-sizing:border-box;} body{background:#f9fafc;font-family:'Open Sans',sans-serif;line-height:1.5;padding:50px 0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;} img{max-width:100%;} .gatsby-highlight{border-bottom:1px solid #e0e6ed;border-top:1px solid #e0e6ed;margin:15px -100px;padding:0;} .gatsby-highlight pre[class*="language-"]{margin:0;padding:25px 100px;} pre[class*="language-"]{background:rgba(245,245,245,1);color:rgb(65,76,94);} @media only screen and (max-width:870px){.gatsby-highlight{margin:15px -15px;}.gatsby-highlight pre[class*="language-"]{padding:25px;}}
/* sc-component-id: sc-htpNat */
.bvxbLs{margin:0 auto;max-width:1080px;}
/* sc-component-id: sc-ifAKCX */
.cMSLWU{margin-top:15px;text-align:center;}
/* sc-component-id: sc-EHOje */
.ijxtcw{border:1px solid #bfc8d2;border-radius:15px;color:#3e465b;display:inline-block;margin:5px;padding:5px 10px;-webkit-text-decoration:none;text-decoration:none;} .ijxtcw svg{display:inline-block;height:20px;stroke:#6e849c;vertical-align:middle;width:20px;} .ijxtcw:hover{border-color:#3e465b;}
/* sc-component-id: sc-bZQynM */
.iSYTTb{color:#3e465b;font-size:35px;line-height:1.5;margin:0;padding:0 30px;text-align:center;}
/* sc-component-id: sc-gzVnrw */
.ipkTNK{color:#666d71;display:block;font-size:1.6em;margin:50px 0 0 0;text-align:center;}
/* sc-component-id: sc-htoDjs */
.dIQAlg{color:#666d71;display:block;font-size:1.6em;margin:50px 0 0 0;text-align:center;margin:0;}
/* sc-component-id: sc-dnqmqq */
.gDybXa{color:#3498db;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: sc-iwsKbI */
.cdEpUV{margin:0 auto;max-width:650px;padding:0 50px 50px;text-align:center;}
/* sc-component-id: sc-gZMcBi */
.cLxazo{color:#65738c;font-size:16px;} .cLxazo a{color:#3498db;font-weight:700;-webkit-text-decoration:none;text-decoration:none;} .cLxazo a:hover{-webkit-text-decoration:underline;text-decoration:underline;} .cLxazo h1{color:#3e465b;font-size:30px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h2{color:#3e465b;font-size:22px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h3{color:#3e465b;font-size:17px;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h4{color:#3e465b;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo h5,.cLxazo h6{color:#3e465b;font-weight:700;line-height:1.5;margin:25px 50px 15px;} .cLxazo p{line-height:1.7;margin:15px 50px;} .cLxazo blockquote{border-left:5px solid #e0e6ed;line-height:1.7;margin:15px 50px 15px 75px;padding:10px 10px 10px 15px;} .cLxazo blockquote p{margin:0;} .cLxazo ul,.cLxazo ol{line-height:1.7;margin:15px 0;padding:0 50px 0 100px;} .cLxazo ul p,.cLxazo ol p,.cLxazo ul ul,.cLxazo ol ul,.cLxazo ul ol,.cLxazo ol ol{margin:0;} .cLxazo ul ul,.cLxazo ol ul,.cLxazo ul ol,.cLxazo ol ol{padding:0 0 0 30px;} .cLxazo img{margin:15px 0;}
/* sc-component-id: sc-gqjmRU */
.iMnMOA h1{color:#3e465b;font-size:35px;line-height:1.5;margin:0;padding:0 30px;text-align:center;} .iMnMOA p{color:#666d71;display:block;font-size:1.6em;margin:0;text-align:center;} .iMnMOA span{background:#9c9da3;display:block;margin:50px auto;height:1px;width:150px;}
/* sc-component-id: sc-VigVT */
.bGukrS{border:1px solid #bfc8d2;border-radius:25px;color:#3e465b;display:inline-block;font-size:10px;font-weight:700;margin:0 10px;padding:5px 15px;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;} .bGukrS:hover{border-color:#000;}
/* sc-component-id: sc-jTzLTM */
.iQIAOc{background:#fff;border:1px solid #e0e6ed;box-shadow:0 1px 5px rgba(0,0,0,0.05);margin-bottom:30px;padding:75px 100px;} @media only screen and (max-width:870px){.iQIAOc{border-left:none;border-right:none;padding:75px 15px;}}
/* sc-component-id: sc-jzJRlG */
.eAaXEV{margin-top:50px;text-align:center;}
/* sc-component-id: sc-cSHVUG */
.iJKMsj{margin-top:50px;text-align:center;}
/* sc-component-id: sc-kAzzGY */
.fDOfVi{border:1px solid #bfc8d2;border-radius:15px;display:inline-block;margin:5px;padding:5px 15px;-webkit-text-decoration:none;text-decoration:none;} .fDOfVi svg{display:inline-block;height:20px;stroke:#6e849c;vertical-align:middle;width:20px;} .fDOfVi:hover{border-color:#3e465b;}
/* sc-component-id: sc-chPdSV */
.ukmsj{margin-top:50px;text-align:center;}
/* sc-component-id: sc-kgoBCf */
.dmFQlA{text-align:center;}
/* sc-component-id: sc-kGXeez */
.hGedeg{color:#3e465b;-webkit-text-decoration:none;text-decoration:none;} .hGedeg:hover{color:#3498db;}
/* sc-component-id: sc-kpOJdX */
.cpnbXC{color:#666d71;display:block;font-size:1.6em;margin:0;text-align:center;}
/* sc-component-id: sc-dxgOiQ */
.eNlzGc{color:#666d71;display:inline-block;font-size:14px;margin-top:50px;-webkit-text-decoration:none;text-decoration:none;} .eNlzGc:hover{color:#3498db;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=b20963e5386fbe2d3f9a949aa901ab35" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3498db"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b20963e5386fbe2d3f9a949aa901ab35"/><title data-react-helmet="true">AWS Lambda custom runtime | Arek Jurasz</title><meta data-react-helmet="true" name="description" content="Dev Blog | Software Engineer"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/d8c6fceef6035ce68615adfef14ec1b550203772-14413fc1ec31b5870784.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js"/><link as="script" rel="preload" href="/2ca085fac04eec258979fa96688fdd6e5c5ad72a-f00de00f4547757df859.js"/><link as="script" rel="preload" href="/app-74ed074e9d7d67137f8f.js"/><link as="script" rel="preload" href="/styles-7d4153d260c0197f0043.js"/><link as="script" rel="preload" href="/webpack-runtime-e095d8b7cd806da303bf.js"/><link as="fetch" rel="preload" href="/page-data/2020-11-23-aws-lambda-custom-runtime/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><link rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAADbmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmjX/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uaNf/bmTP/2pUq/9uZM//bmjT/25o1/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25o1/9ybN//alSv/25o1/+KtXP/bmDL/2pYt/9qVK//cmzb/25o1/9uZM//bmTP/25kz/9uZM//bmTP/25o0/9qVK//YjyD/36RJ/+W1bf/25s//3J07/+CoUv/irFv/2JAh/9mUKP/bmTT/25kz/9uZM//bmTP/25k0/9qVLP/hqVT/8tq3///////pwob/8tq1/+OvYf/ksmb///////Xjyf/jsWX/2pYt/9uZM//bmTP/3Js2/9mTJ//uz6H///////DUq//eo0j/1owZ/+7Nnf/tzJr/140b/9ydPP/syJP///////ThxP/aliz/25o0/9uaNf/alSv/57t5//nv4P/25s//68eR/9ybOP/ltGv/896//9qWL//pwIP/9eLG//nw4//rx5H/2pYu/9uaNP/bmTP/25o0/9mTKP/blzH/57t4//rx5f/ty5n/3Js3//Xjyf/pwYX/+/Tq/+rDif/cnDn/2ZIl/9uZNP/bmTP/25kz/9uZM//bmjX/25kz/9iRJP/ZlCr/3Z9A/9mUKf/z38D/5bRs/9iRJf/YkST/25gx/9yaNv/bmTP/25kz/9uZM//bmTP/25kz/9uZM//cmjb/25o0/9uYMP/bmDH/3Z4//9ybOf/bmDH/3Js3/9uZNP/bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTT/25kz/9uYMP/bmDH/25k0/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTT/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/25kz/9uZM//bmTP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><section class="sc-htpNat bvxbLs"><header class="sc-iwsKbI cdEpUV"><h1 class="sc-bZQynM iSYTTb"><a class="sc-dnqmqq gDybXa" href="/">Arek Jurasz</a></h1><p class="sc-gzVnrw sc-htoDjs dIQAlg">Software Engineer</p><div class="sc-ifAKCX cMSLWU"><a href="https://twitter.com/arekjurasz" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://github.com/ajurasz" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/arkadiusz-jurasz/" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://ajurasz.github.io/rss.xml" target="_blank" rel="noopener" class="sc-EHOje ijxtcw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></header></section><section class="sc-htpNat bvxbLs"><div class="sc-jTzLTM iQIAOc"><div class="sc-gqjmRU iMnMOA"><h1>AWS Lambda custom runtime</h1><p>November 23, 2020</p><span></span></div><article class="sc-gZMcBi cLxazo"><div><p>AWS Lambda support many <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html">build in runtimes</a>. But we also have a possibility to create custom runtimes to run functions in a language that is not yet supported by Lambda service or when we need to do some extra optimization (i.e. reduce startup time or memory footprint of functions build for JVM). Today we will learn how to build a very simple runtime focusing mainly on steps required to do so.</p>
<!-- end -->
<h2>Custom runtime</h2>
<p>Every runtime is executed on Amazon Linux or Amazon Linux 2 operating system. In case of JVM, functions need at least a Java Runtime Environment (JRE) to run a <code class="language-text">jar</code> but it won’t be available out of the box on mentioned systems. Thankfully starting from Java 9 a <code class="language-text">jlink</code> tool was introduced which creates a customized JRE that contains only these modules that are required by your own module - this way JRE can be part of the deployment package.</p>
<p>To create a runtime we need a <code class="language-text">bootstrap</code> file to be present in the root of a deployment package. This file is an entry point for the custom runtime and will be called by Lambda as part of <code class="language-text">init</code> phase.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/f60c089ea1f585cd0857a47ec3dbe386/29007/lambda-execution-environment-lifecycle.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin: 15px -30px !important max-width: 700px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 18.857142857142858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQI1x2Ku04DMRRE9///BdGGiFRQ0CAR0YAikrAgwq7j+HFt34fXNg6jU5wZzTAHmDwoi8ZDDFNKltBSOl/pQoGSIuxVs5CPcrakIE7gXUrD3fh+fxgft3H3cdSH26SfG77SvOq0uG10XPQ6/q6re2gN9z+yeZo2u/Hm7eXTm8EIGmZlGEIsrEr2dYHgvju1e0EKJ2e+CuvWCnKdLzgqfQKHWYZFck+IAYk5V5I+VOuj9YmlsCwQSVugq2f5f+qLSQlZ5A8imOChMNa4bwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Lambda execution environment lifecycle"
        title=""
        src="/static/f60c089ea1f585cd0857a47ec3dbe386/8c557/lambda-execution-environment-lifecycle.png"
        srcset="/static/f60c089ea1f585cd0857a47ec3dbe386/4edbd/lambda-execution-environment-lifecycle.png 175w,
/static/f60c089ea1f585cd0857a47ec3dbe386/13ae7/lambda-execution-environment-lifecycle.png 350w,
/static/f60c089ea1f585cd0857a47ec3dbe386/8c557/lambda-execution-environment-lifecycle.png 700w,
/static/f60c089ea1f585cd0857a47ec3dbe386/e996b/lambda-execution-environment-lifecycle.png 1050w,
/static/f60c089ea1f585cd0857a47ec3dbe386/2cefc/lambda-execution-environment-lifecycle.png 1400w,
/static/f60c089ea1f585cd0857a47ec3dbe386/29007/lambda-execution-environment-lifecycle.png 1600w"
        sizes="(max-width: 700px) 100vw, 700px"
      />
    </span>
  </span>
  
  </a>
    </p>
<blockquote>
<p>Source: <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-context.html">https://docs.aws.amazon.com/lambda/latest/dg/runtimes-context.html</a></p>
</blockquote>
<h2>Deployment package</h2>
<p>So far we know that custom runtime will require a <code class="language-text">bootstrap</code> file and custom JRE. Since we will be working with (<a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">SAM CLI</a>) we can use the possibility to customize <code class="language-text">build</code> command. This can be done by providing <code class="language-text">Metadata</code> resource attribute with a <code class="language-text">BuildMethod: makefile</code> entry</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">Resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">NaiveJavaRuntimeFunction</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>Function
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">CodeUri</span><span class="token punctuation">:</span> NaiveJavaRuntime
      <span class="token key atrule">Handler</span><span class="token punctuation">:</span> do.not.apply
      <span class="token key atrule">Runtime</span><span class="token punctuation">:</span> provided
      <span class="token key atrule">MemorySize</span><span class="token punctuation">:</span> <span class="token number">128</span>
    <span class="token key atrule">Metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">BuildMethod</span><span class="token punctuation">:</span> makefile</code></pre></div>
<p>By convention <code class="language-text">sam build</code> will look for <code class="language-text">build-NaiveJavaRuntimeFunction</code> target in a <code class="language-text">Makefile</code>. </p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">build-NaiveJavaRuntimeFunction:
  @ mvn clean package
  @ chmod +x ./target/classes/bootstrap
  @ cp -rf ./target/classes/bootstrap $(ARTIFACTS_DIR)
  @ jlink --module-path ./target/naive-java-runtime.jar:$(JAVA_HOME)/jmods \
         --add-modules  naive.java.runtime \
         --output ./target/dist \
         --launcher executable=naive.java.runtime/io.github.ajurasz.naivejavaruntime.Bootstrap \
         --compress 2 --no-header-files --no-man-pages --strip-debug
  @ cp -rf ./target/dist $(ARTIFACTS_DIR)</code></pre></div>
<p>Here’s what is happening:</p>
<ol>
<li>Build package using maven</li>
<li>Change <code class="language-text">bootstrap</code> file permission</li>
<li>Copy <code class="language-text">bootstrap</code> file (which is part of project resources) to <code class="language-text">ARTIFACTS_DIR</code></li>
<li>Build custom JRE. Notice <code class="language-text">--launcher</code> option which will create an executable file (<code class="language-text">dist/bin/executable</code>) which when called will run the main method</li>
<li>Copy output created by <code class="language-text">jlink</code> to <code class="language-text">ARTIFACTS_DIR</code></li>
</ol>
<p>At the end <code class="language-text">ARTIFACTS_DIR</code> will look like this:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">.</span>
├── bootstrap
└── dist
    ├── bin
    │   ├── executable
    │   ├── java
    │   └── keytool
    ├── conf
    │   ├── net.properties
    │   └── security
    ├── legal
    │   ├── java.base
    │   └── java.net.http
    ├── lib
    │   ├── classlist
    │   ├── jexec
    │   ├── jli
    │   ├── jrt-fs.jar
    │   ├── jspawnhelper
    │   ├── jvm.cfg
    │   ├── libjava.so
    │   ├── libjimage.so
    │   ├── libjsig.so
    │   ├── libnet.so
    │   ├── libnio.so
    │   ├── libverify.so
    │   ├── libzip.so
    │   ├── modules
    │   ├── security
    │   ├── server
    │   └── tzdb.dat
    └── release</code></pre></div>
<p>When the function was deployed we can give it a try in Lambda console.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/c15081c31a4d6f0ea43beb009be77521/d004c/lambda-function-output.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin: 15px -30px !important max-width: 700px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 37.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAC4jAAAuIwF4pT92AAABGElEQVQoz22Rx5LEIAxE/f8fOTsBB0wOBmwfepAm1FbtHl4JtYJNMwh1xW3+wbjecF8f0HGFzYSCTStj0iv3m4Z743/BedHcMygvIfUCnyxctAjZwRMlvmJyXNtaQj0L6rEx5R9yixhWN2NWI0JxjN8sUgvI+4fYGwNM7H+YDVyH+khLf/AYpJswKcEDpl+XCMVyMVb3jULeueYyXdOw/iE2xz0EL5y1QKi0xH2LtJQGCVoydn+n3qeD7HZ0e0h/+0ezn48Pi5lwuV4wzgJiemBcRoj5wb4qu7KHIXuE5OHjy9OwJcQOaVSrR/d2L4jdisEEhUVKKK2hjYYxhs85Z9RasR870/aG8zw7B1prOCh2jel5KYUf9Al3HRYl6YsobgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Lambda function output"
        title=""
        src="/static/c15081c31a4d6f0ea43beb009be77521/8c557/lambda-function-output.png"
        srcset="/static/c15081c31a4d6f0ea43beb009be77521/4edbd/lambda-function-output.png 175w,
/static/c15081c31a4d6f0ea43beb009be77521/13ae7/lambda-function-output.png 350w,
/static/c15081c31a4d6f0ea43beb009be77521/8c557/lambda-function-output.png 700w,
/static/c15081c31a4d6f0ea43beb009be77521/e996b/lambda-function-output.png 1050w,
/static/c15081c31a4d6f0ea43beb009be77521/2cefc/lambda-function-output.png 1400w,
/static/c15081c31a4d6f0ea43beb009be77521/d004c/lambda-function-output.png 1611w"
        sizes="(max-width: 700px) 100vw, 700px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2>Runtime</h2>
<p>Beside initialization, custom runtime is also responsible for <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html#runtimes-custom-build">processing tasks</a> consisting of:</p>
<ol>
<li>Getting an event</li>
<li>Propagating the tracing header</li>
<li>Creating a context object</li>
<li>Invoking the function handler</li>
<li>Handling the response</li>
<li>Handling errors</li>
<li>Cleanup</li>
</ol>
<p>My naive implementation meets just three of these tasks. To support all of them it would require much more development and then the maintenance of that code. But there is a better alternative to reinventing the wheel - taking advantage of very impressive <a href="https://quarkus.io/guides/funqy-amazon-lambda">Quarkus module</a>. Except that it provides an implementation for all processing tasks it also gives the possibility to build a native image which additionally lower memory footprint and accelerates initialization times. All this can be done with small adjustments to <a href="https://github.com/ajurasz/lambda-custom-runtime/blob/master/FunqyAmazonLambda/pom.xml">pom.xml</a>. </p>
<p>When the function was deployed we can give it a try in Lambda console.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/1a57f36b47e77e7f875768909e73192d/12e1b/lambda-function-output-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin: 15px -30px !important max-width: 700px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 37.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAC4jAAAuIwF4pT92AAABHUlEQVQoz3XQ6W7DIAwA4Lz/Q3Zrl5NgsDkasiF7DksqTdp+fPIphNz161u5j7fSm3t5mEexYSkumQJpLRDNi9PaZ/svfNq200EwsjojIaNQwlekLQpdefLy3JPsdZPy9Wy2P+TPKN3iRh5Nz5gdY4IW0x4UtZjP3KJhHy07RcdOIY6ndIoFuTN+khlGcXE9WQmbFx3+ioP5EAir+GT159D6l2N+6RY/8gQD0xNYG8oxKdS6yZb1EdYHebQ964m079hnaH29X9sPjefu+N3t/SbGLrLYWVYwsqyzWG8FVEgkMQe9LQlF/Km3rFLrHbP9a9P7Fsm73hDI1GEY6jRNdVTzPLcaAKrzroYQKhFWPCBqTg1ePeXR1xhTjVuo34hWFHZBQnGHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Lambda function output 2"
        title=""
        src="/static/1a57f36b47e77e7f875768909e73192d/8c557/lambda-function-output-2.png"
        srcset="/static/1a57f36b47e77e7f875768909e73192d/4edbd/lambda-function-output-2.png 175w,
/static/1a57f36b47e77e7f875768909e73192d/13ae7/lambda-function-output-2.png 350w,
/static/1a57f36b47e77e7f875768909e73192d/8c557/lambda-function-output-2.png 700w,
/static/1a57f36b47e77e7f875768909e73192d/e996b/lambda-function-output-2.png 1050w,
/static/1a57f36b47e77e7f875768909e73192d/2cefc/lambda-function-output-2.png 1400w,
/static/1a57f36b47e77e7f875768909e73192d/12e1b/lambda-function-output-2.png 1607w"
        sizes="(max-width: 700px) 100vw, 700px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Please notice time difference between these two functions, native executable is 11 times faster. If it comes to deployment package size it’s 30% smaller (24 MB instead of 34 MB).</p>
<p>Source code can be found <a href="https://github.com/ajurasz/lambda-custom-runtime">here</a>.</p></div></article><div class="sc-cSHVUG iJKMsj"><h2 class="sc-bdVaJa cBVFwB">Share This Post</h2><a href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank" aria-label="Share on Facebook" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a><a href="https://twitter.com/intent/tweet?text=AWS%20Lambda%20custom%20runtime&amp;url=" target="_blank" aria-label="Share on Twitter" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=&amp;title=AWS%20Lambda%20custom%20runtime" target="_blank" aria-label="Share on LinkedIn" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="mailto:?subject=AWS%20Lambda%20custom%20runtime&amp;body=" aria-label="Share by Email" rel="noopener" class="sc-kAzzGY fDOfVi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></div></div><div class="sc-jzJRlG eAaXEV"><a rel="prev" class="sc-VigVT bGukrS" href="/2020-11-17-manage-schema-evolution-in-the-serverless-stack/">← <!-- -->Managing schema evolution in the serverless stack</a></div></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-70225806-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020-11-23-aws-lambda-custom-runtime/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-303683f6c6a5fb752dca.js"],"app":["/app-74ed074e9d7d67137f8f.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-36dc033f967ae9fe9cda.js"],"component---src-pages-404-js":["/component---src-pages-404-js-eb0bdeafcc9777c65a54.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js"],"component---src-templates-index-js":["/component---src-templates-index-js-8594de3e8d4418bd418f.js"]};/*]]>*/</script><script src="/polyfill-303683f6c6a5fb752dca.js" nomodule=""></script><script src="/webpack-runtime-e095d8b7cd806da303bf.js" async=""></script><script src="/styles-7d4153d260c0197f0043.js" async=""></script><script src="/app-74ed074e9d7d67137f8f.js" async=""></script><script src="/2ca085fac04eec258979fa96688fdd6e5c5ad72a-f00de00f4547757df859.js" async=""></script><script src="/component---src-templates-blog-post-js-e303bc9294d162a97b8b.js" async=""></script><script src="/d8c6fceef6035ce68615adfef14ec1b550203772-14413fc1ec31b5870784.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script></body></html>